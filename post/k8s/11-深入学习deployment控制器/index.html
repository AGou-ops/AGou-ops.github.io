<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>11 深入学习Deployment控制器 - AGou's blog</title><meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=MobileOptimized content="width"><meta name=HandheldFriendly content="true"><meta name=applicable-device content="pc,mobile"><meta name=theme-color content="#f8f5ec"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><meta name=mobile-web-app-capable content="yes"><meta name=author content="AGou-ops"><meta name=description content="写在前面 前面的文章我们深入介绍了Pod的使用，包括Pod定义，Pod资源管理和服务质量，Pod健康检查，Pod存储管理，Pod调度，当Pod"><meta name=keywords content="AGou,AGou-ops,阿狗,阿狗博客,阿狗的博客,AGou blog"><meta name=baidu-site-verification content="eS8otJ2dE7My4oKT"><meta name=generator content="Hugo 0.75.1"><link rel=canonical href=https://agou-ops.cn/post/k8s/11-%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0deployment%E6%8E%A7%E5%88%B6%E5%99%A8/><link rel=icon type=image/x-ico href=https://s1.ax1x.com/2020/05/19/Y4cixe.png><link rel=stylesheet href=/sass/jane.min.5f2fe3fb513889592785b1bd02ae09514f6c36ea67c4f178b1424eafc16d4b93.css integrity media=screen crossorigin=anonymous><link rel=stylesheet href=/css/layer.css><meta property="og:title" content="11 深入学习Deployment控制器"><meta property="og:description" content="写在前面 前面的文章我们深入介绍了Pod的使用，包括Pod定义，Pod资源管理和服务质量，Pod健康检查，Pod存储管理，Pod调度，当Pod"><meta property="og:type" content="article"><meta property="og:url" content="https://agou-ops.cn/post/k8s/11-%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0deployment%E6%8E%A7%E5%88%B6%E5%99%A8/"><meta property="article:published_time" content="2019-08-04T10:36:48+08:00"><meta property="article:modified_time" content="2019-08-04T10:36:48+08:00"><meta itemprop=name content="11 深入学习Deployment控制器"><meta itemprop=description content="写在前面 前面的文章我们深入介绍了Pod的使用，包括Pod定义，Pod资源管理和服务质量，Pod健康检查，Pod存储管理，Pod调度，当Pod"><meta itemprop=datePublished content="2019-08-04T10:36:48+08:00"><meta itemprop=dateModified content="2019-08-04T10:36:48+08:00"><meta itemprop=wordCount content="6224"><meta itemprop=keywords content="kubernetes,"><meta name=twitter:card content="summary"><meta name=twitter:title content="11 深入学习Deployment控制器"><meta name=twitter:description content="写在前面 前面的文章我们深入介绍了Pod的使用，包括Pod定义，Pod资源管理和服务质量，Pod健康检查，Pod存储管理，Pod调度，当Pod"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script><script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--><script async src="https://www.googletagmanager.com/gtag/js?id=G-2DZCW6NJZF"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','G-2DZCW6NJZF');</script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/docsearch.js@2.6.3/dist/cdn/docsearch.min.css></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=/ class=logo>AGou's blog</a></div><div class=mobile-navbar-icon><span></span><span></span><span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><li class=mobile-menu-item><a class=menu-item-link href=https://agou-ops.cn/>主页</a></li><li class=mobile-menu-item><a class=menu-item-link href=https://agou-ops.cn/post/>归档</a></li><li class=mobile-menu-item><a class=menu-item-link href=https://agou-ops.cn/tags/>标签</a></li><li class=mobile-menu-item><a class=menu-item-link href=https://agou-ops.cn/aboutme/>关于</a></li><li class=mobile-menu-item><a class=menu-item-link href=https://agou-ops.cn/anime/>💞Anime</a></li><li class=mobile-menu-item><a class=menu-item-link href=https://agou-ops.cn/myDocsv2 rel=noopener target=_blank>myDocs
<i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18"><path d="M623.36 272.96 473.216 423.04C467.2 429.056 467.072 438.656 472.896 444.416c0 0-6.72-6.656 1.6 1.6C496.064 467.648 528.64 500.224 528.64 500.224 534.464 506.048 544 505.856 550.016 499.904l150.08-150.144 67.328 66.432c9.024 8.96 27.456 4.544 30.4-8.96 19.968-92.608 46.656-227.52 46.656-227.52 6.848-34.496-16.192-56.704-49.92-49.92.0.0-134.656 26.816-227.328 46.784C560.32 178.048 556.352 182.272 554.752 187.136c-3.2 6.208-3.008 14.208 3.776 20.992L623.36 272.96z"/><path d="M841.152 457.152c-30.528.0-54.784 24.512-54.784 54.656V786.56H237.696V237.696h206.016c6.656.0 10.752.0 13.248.0C487.68 237.696 512 213.184 512 182.848 512 152.32 487.36 128 456.96 128H183.04C153.216 128 128 152.576 128 182.848c0 3.136.256 6.272.768 9.28C128.256 195.136 128 198.272 128 201.408v639.488c0 .064.0.192.0.256.0.128.0.192.0.32.0 30.528 24.512 54.784 54.784 54.784H829.76c6.592.0 9.728.0 11.712.0 28.736.0 52.928-22.976 54.464-51.968C896 843.264 896 842.304 896 841.344v-20.352V561.408 512.128C896 481.792 871.424 457.152 841.152 457.152z"/></svg></i></a></li><input size=15 maxlength=15 type=search class=docsearch placeholder="Search Here..."></ul></nav><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.3/photoswipe.min.css integrity="sha256-LWdHSKWG7zv3DTpee8YAgoTfkj3gNkfauF624h4P2Nw=" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.3/default-skin/default-skin.min.css integrity="sha256-Q9bBMw/rHRRag46GDWY84J3elDNc8JJjKXL9tIC4oe8=" crossorigin=anonymous><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><style>.fork-me-on-github{position:absolute;top:0;right:0;border:0}@media(max-width:1080px){.fork-me-on-github{display:none}}</style><a href=https://github.com/AGou-ops><img loading=lazy width=149 height=149 class=fork-me-on-github src=https://agou-images.oss-cn-qingdao.aliyuncs.com/BaseIMG/forkme_right_gray_6d6d6d.svg data-recalc-dims=1 alt="Fork me on GitHub"></a><header id=header class="header container"><div class=logo-wrapper><a href=/ class=logo>AGou's blog</a></div><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=https://agou-ops.cn/>主页</a></li><li class=menu-item><a class=menu-item-link href=https://agou-ops.cn/post/>归档</a></li><li class=menu-item><a class=menu-item-link href=https://agou-ops.cn/tags/>标签</a></li><li class=menu-item><a class=menu-item-link href=https://agou-ops.cn/aboutme/>关于</a></li><li class=menu-item><a class=menu-item-link href=https://agou-ops.cn/anime/>💞Anime</a></li><li class=menu-item><a class=menu-item-link href=https://agou-ops.cn/myDocsv2 rel=noopener target=_blank>myDocs
<i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18"><path d="M623.36 272.96 473.216 423.04C467.2 429.056 467.072 438.656 472.896 444.416c0 0-6.72-6.656 1.6 1.6C496.064 467.648 528.64 500.224 528.64 500.224 534.464 506.048 544 505.856 550.016 499.904l150.08-150.144 67.328 66.432c9.024 8.96 27.456 4.544 30.4-8.96 19.968-92.608 46.656-227.52 46.656-227.52 6.848-34.496-16.192-56.704-49.92-49.92.0.0-134.656 26.816-227.328 46.784C560.32 178.048 556.352 182.272 554.752 187.136c-3.2 6.208-3.008 14.208 3.776 20.992L623.36 272.96z"/><path d="M841.152 457.152c-30.528.0-54.784 24.512-54.784 54.656V786.56H237.696V237.696h206.016c6.656.0 10.752.0 13.248.0C487.68 237.696 512 213.184 512 182.848 512 152.32 487.36 128 456.96 128H183.04C153.216 128 128 152.576 128 182.848c0 3.136.256 6.272.768 9.28C128.256 195.136 128 198.272 128 201.408v639.488c0 .064.0.192.0.256.0.128.0.192.0.32.0 30.528 24.512 54.784 54.784 54.784H829.76c6.592.0 9.728.0 11.712.0 28.736.0 52.928-22.976 54.464-51.968C896 843.264 896 842.304 896 841.344v-20.352V561.408 512.128C896 481.792 871.424 457.152 841.152 457.152z"/></svg></i></a></li><input size=15 maxlength=15 type=search class=docsearch-input placeholder="Search Here..."></ul></nav></header><div id=mobile-panel><main id=main class="main bg-llight"><div class=content-wrapper><div id=content class="content container"><article class="post bg-white"><header class=post-header><h1 class=post-title>11 深入学习Deployment控制器</h1><div class=post-meta><time datetime=2019-08-04 class=post-time>2019-08-04</time><div class=post-category><a href=https://agou-ops.cn/categories/%E8%BD%AC%E8%BD%BD/>转载</a>
<a href=https://agou-ops.cn/categories/kubernetes/>kubernetes</a>
<a href=https://agou-ops.cn/categories/%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/>基础教程</a></div><span class=more-meta>6224 words</span>
<span class=more-meta>13 min read</span>
<span id=busuanzi_container_page_pv>| 阅读 <span id=busuanzi_value_page_pv></span></span></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title>Table of Contents</h2><div class=post-toc-content><nav id=TableOfContents><ul><li><a href=#11-控制器概述>1.1 控制器概述</a></li><li><a href=#12-deployment>1.2 Deployment</a><ul><li><a href=#121-deployment定义>1.2.1 Deployment定义</a></li><li><a href=#122-deployment扩容>1.2.2 Deployment扩容</a></li><li><a href=#123-滚动更新>1.2.3 滚动更新</a></li><li><a href=#124-版本回退>1.2.4 版本回退</a></li></ul></li><li><a href=#13-replicaset>1.3 ReplicaSet</a></li><li><a href=#14-replicationcontroller>1.4 ReplicationController</a></li></ul></nav></div></div><div class=post-content><h1 id=写在前面>写在前面</h1><p>前面的文章我们深入介绍了Pod的使用，包括<a href=#>Pod定义</a>，<a href=#>Pod资源管理和服务质量</a>，<a href=#>Pod健康检查</a>，<a href=#>Pod存储管理</a>，<a href=#>Pod调度</a>，当Pod所在的node异常时，Pod无法自动恢复，因此Pod很少单独使用，一般以template的形式嵌套在控制器中使用，下来介绍<a href=#>kubernetes系列教程</a>副本控制器Deployment，ReplicaSet，ReplicationController的使用。</p><h1 id=1-深入学习控制器>1. 深入学习控制器</h1><h2 id=11-控制器概述>1.1 控制器概述</h2><p>Pod是kubernetes所有运行应用或部署服务的基础，可以看作是k8s中运行的机器人，应用单独运行在Pod中不具备高级的特性，比如节点故障时Pod无法自动迁移，Pod多副本横向扩展，应用滚动升级RollingUpdate等，因此Pod一般不会单独使用，需要使用控制器来实现。</p><p>我们先看一个概念ReplicationController副本控制器，简称RC，副本控制是实现Pod高可用的基础，其通过定义副本的副本数replicas，当运行的Pod数量少于replicas时RC会自动创建Pod，当Pod数量多于replicas时RC会自动删除多余的Pod，确保当前运行的Pod和RC定义的副本数保持一致。</p><p>副本控制器包括Deployment，ReplicaSet，ReplicationController，StatefulSet等。其中常用有两个：Deployment和StatefulSet，Deployment用于无状态服务，StatefulSet用于有状态服务，ReplicaSet作为Deployment后端副本控制器，ReplicationController则是旧使用的副本控制器。</p><p>为了实现不同的功能，kubernetes中提供多种不同的控制器满足不同的业务场景，可以分为四类：</p><ul><li>Stateless application无状态化应用，如Deployment，ReplicaSet，RC等；</li><li>Stateful application有状态化应用，需要保存数据状态，如数据库，数据库集群；</li><li>Node daemon节点支撑守护，适用于在所有或部分节点运行Daemon，如日志，监控采集；</li><li>Batch批处理任务，非长期运行服务，分为一次性运行Job和计划运行CronJob两种。</li></ul><p>本文我们主要介绍无状态服务副本控制器的使用，包括Deployment，ReplicaSet和ReplicationController。</p><h2 id=12-deployment>1.2 Deployment</h2><p>Deployment是实现无状态应用副本控制器，其通过declarative申明式的方式定义Pod的副本数，Deployment的副本机制是通过ReplicaSet实现，replicas副本的管理通过在ReplicaSet中添加和删除Pod，RollingUpdate通过新建ReplicaSet，然后逐步移除和添加ReplicaSet中的Pod数量，从而实现滚动更新，使用Deployment的场景如下：</p><ul><li>滚动升级RollingUpdate，后台通过ReplicaSet实现</li><li>多副本replicas实现，增加副本(高负载)或减少副本(低负载)</li><li>应用回滚Rollout，版本更新支持回退</li></ul><h3 id=121-deployment定义>1.2.1 Deployment定义</h3><p>\1. 我们定义一个Deployment，副本数为3，Pod以模版Template的形式封装在Deployment中，为了结合之前Pod学习内容，我们增加了resource和健康检查的定义，具体实现参考前面介绍的文章。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-js data-lang=js><span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=nx>happylau</span><span class=p>]</span><span class=err>#</span> <span class=nx>cat</span> <span class=nx>deployment</span><span class=o>-</span><span class=nx>demo</span><span class=p>.</span><span class=nx>yaml</span> 
<span class=nx>apiVersion</span><span class=o>:</span> <span class=nx>apps</span><span class=o>/</span><span class=nx>v1</span>
<span class=nx>kind</span><span class=o>:</span> <span class=nx>Deployment</span>
<span class=nx>metadata</span><span class=o>:</span>            <span class=err>#</span><span class=nx>Deployment的元数据信息</span><span class=err>，</span><span class=nx>包含名字</span><span class=err>，</span><span class=nx>标签</span>
  <span class=nx>name</span><span class=o>:</span> <span class=nx>deployment</span><span class=o>-</span><span class=nx>nginx</span><span class=o>-</span><span class=nx>demo</span>
  <span class=nx>labels</span><span class=o>:</span>
    <span class=nx>app</span><span class=o>:</span> <span class=nx>nginx</span>
    <span class=nx>rc</span><span class=o>:</span> <span class=nx>deployment</span>
  <span class=nx>annotations</span><span class=o>:</span>
    <span class=nx>kubernetes</span><span class=p>.</span><span class=nx>io</span><span class=o>/</span><span class=nx>replicationcontroller</span><span class=o>:</span> <span class=nx>Deployment</span>
    <span class=nx>kubernetes</span><span class=p>.</span><span class=nx>io</span><span class=o>/</span><span class=nx>description</span><span class=o>:</span> <span class=s2>&#34;ReplicationController Deployment Demo&#34;</span>
<span class=nx>spec</span><span class=o>:</span>
  <span class=nx>replicas</span><span class=o>:</span> <span class=mi>3</span>          <span class=err>#</span><span class=nx>副本数量</span><span class=err>，</span><span class=nx>包含有3个Pod副本</span>
  <span class=nx>selector</span><span class=o>:</span>            <span class=err>#</span><span class=nx>标签选择器</span><span class=err>，</span><span class=nx>选择管理包含指定标签的Pod</span>
    <span class=nx>matchLabels</span><span class=o>:</span>
      <span class=nx>app</span><span class=o>:</span> <span class=nx>nginx</span>
      <span class=nx>rc</span><span class=o>:</span> <span class=nx>deployment</span>
  <span class=nx>template</span><span class=o>:</span>       <span class=err>#</span><span class=nx>如下是Pod的模板定义</span><span class=err>，</span><span class=nx>没有apiVersion</span><span class=err>，</span><span class=nx>Kind属性</span><span class=err>，</span><span class=nx>需包含metadata定义</span>
    <span class=nx>metadata</span><span class=o>:</span>          <span class=err>#</span><span class=nx>Pod的元数据信息</span><span class=err>，</span><span class=nx>必须包含有labels</span>
      <span class=nx>labels</span><span class=o>:</span>
        <span class=nx>app</span><span class=o>:</span> <span class=nx>nginx</span>
        <span class=nx>rc</span><span class=o>:</span> <span class=nx>deployment</span> 
    <span class=nx>spec</span><span class=o>:</span>              <span class=err>#</span><span class=nx>spec指定容器的属性信息</span>
      <span class=nx>containers</span><span class=o>:</span>
      <span class=o>-</span> <span class=nx>name</span><span class=o>:</span> <span class=nx>nginx</span><span class=o>-</span><span class=nx>deployment</span>
        <span class=nx>image</span><span class=o>:</span> <span class=nx>nginx</span><span class=o>:</span><span class=mf>1.7.9</span>
        <span class=nx>imagePullPolicy</span><span class=o>:</span> <span class=nx>IfNotPresent</span>
        <span class=nx>ports</span><span class=o>:</span>          <span class=err>#</span><span class=nx>容器端口信息</span>
        <span class=o>-</span> <span class=nx>name</span><span class=o>:</span> <span class=nx>http</span><span class=o>-</span><span class=mi>80</span><span class=o>-</span><span class=nx>port</span>
          <span class=nx>protocol</span><span class=o>:</span> <span class=nx>TCP</span>
          <span class=nx>containerPort</span><span class=o>:</span> <span class=mi>80</span>
        <span class=nx>resources</span><span class=o>:</span>      <span class=err>#</span><span class=nx>资源管理</span><span class=p>,</span><span class=nx>requests请求资源</span><span class=err>，</span><span class=nx>limits限制资源</span>
          <span class=nx>requests</span><span class=o>:</span>
            <span class=nx>cpu</span><span class=o>:</span> <span class=mi>100</span><span class=nx>m</span>
            <span class=nx>memory</span><span class=o>:</span> <span class=mi>128</span><span class=nx>Mi</span>
          <span class=nx>limits</span><span class=o>:</span>
            <span class=nx>cpu</span><span class=o>:</span> <span class=mi>200</span><span class=nx>m</span>
            <span class=nx>memory</span><span class=o>:</span> <span class=mi>256</span><span class=nx>Mi</span>
        <span class=nx>livenessProbe</span><span class=o>:</span>  <span class=err>#</span><span class=nx>健康检查器livenessProbe</span><span class=err>，</span><span class=nx>存活检查</span>
          <span class=nx>httpGet</span><span class=o>:</span>
            <span class=nx>path</span><span class=o>:</span> <span class=err>/index.html</span>
            <span class=nx>port</span><span class=o>:</span> <span class=mi>80</span>
            <span class=nx>scheme</span><span class=o>:</span> <span class=nx>HTTP</span>
          <span class=nx>initialDelaySeconds</span><span class=o>:</span> <span class=mi>3</span>
          <span class=nx>periodSeconds</span><span class=o>:</span> <span class=mi>5</span>
          <span class=nx>timeoutSeconds</span><span class=o>:</span> <span class=mi>2</span>
        <span class=nx>readinessProbe</span><span class=o>:</span>  <span class=err>#</span><span class=nx>健康检查器readinessProbe</span><span class=err>，</span><span class=nx>就绪检查</span>
          <span class=nx>httpGet</span><span class=o>:</span>
            <span class=nx>path</span><span class=o>:</span> <span class=err>/index.html</span>
            <span class=nx>port</span><span class=o>:</span> <span class=mi>80</span>
            <span class=nx>scheme</span><span class=o>:</span> <span class=nx>HTTP</span>
          <span class=nx>initialDelaySeconds</span><span class=o>:</span> <span class=mi>3</span>
          <span class=nx>periodSeconds</span><span class=o>:</span> <span class=mi>5</span>
          <span class=nx>timeoutSeconds</span><span class=o>:</span> <span class=mi>2</span>
</code></pre></td></tr></table></div></div><p>Deployment字段说明：</p><ul><li>deployment基本属性，包括apiVersion,Kind,metadata和spec，其中，deployment.metdata指定名称和标签内容，deployment.spec指定部署组的属性信息；</li><li>deployment属性信息包含有replicas，Selector和template，其中replicas指定副本数目，Selector指定管理的Pod标签，template为定义Pod的模板，Deployment通过模板创建Pod；</li><li>deployment.spec.template为Pod定义的模板，和Pod定义不太一样，template中不包含apiVersion和Kind属性，要求必须有metadata，deployment.spec.template.spec为容器的属性信息，其他定义内容和Pod一致。</li></ul><p>\2. 生成Deployment，创建时加一个&ndash;record参数,会在annotation中记录deployment.kubernetes.io/revision版本</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-js data-lang=js><span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=nx>happylau</span><span class=p>]</span><span class=err>#</span> <span class=nx>kubectl</span> <span class=nx>apply</span> <span class=o>-</span><span class=nx>f</span> <span class=nx>deployment</span><span class=o>-</span><span class=nx>demo</span><span class=p>.</span><span class=nx>yaml</span> <span class=o>--</span><span class=nx>record</span>
<span class=nx>deployment</span><span class=p>.</span><span class=nx>apps</span><span class=o>/</span><span class=nx>deployment</span><span class=o>-</span><span class=nx>nginx</span><span class=o>-</span><span class=nx>demo</span> <span class=nx>created</span>
</code></pre></td></tr></table></div></div><p>\3. 查看Deployment列表，运行时自动下载镜像，如下已运行了3个副本</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-js data-lang=js><span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=nx>happylau</span><span class=p>]</span><span class=err>#</span> <span class=nx>kubectl</span> <span class=nx>get</span> <span class=nx>deployments</span> <span class=nx>deployment</span><span class=o>-</span><span class=nx>nginx</span><span class=o>-</span><span class=nx>demo</span> 
<span class=nx>NAME</span>                    <span class=nx>READY</span>   <span class=nx>UP</span><span class=o>-</span><span class=nx>TO</span><span class=o>-</span><span class=nx>DATE</span>   <span class=nx>AVAILABLE</span>   <span class=nx>AGE</span>
<span class=nx>deployment</span><span class=o>-</span><span class=nx>nginx</span><span class=o>-</span><span class=nx>demo</span>   <span class=mi>3</span><span class=o>/</span><span class=mi>3</span>     <span class=mi>3</span>            <span class=mi>3</span>           <span class=mi>2</span><span class=nx>m37s</span>

<span class=nx>NAME代表名称</span><span class=p>,</span><span class=nx>metadata</span><span class=p>.</span><span class=nx>name字段定义</span>
<span class=nx>READY代表Pod的健康状态</span><span class=err>，</span><span class=nx>前面值是readiness</span><span class=err>，</span><span class=nx>后面是liveness</span>
<span class=nx>UP</span><span class=o>-</span><span class=nx>TO</span><span class=o>-</span><span class=nx>DATE代表更新</span><span class=err>，</span><span class=nx>用于滚动升级</span>
<span class=nx>AVAILABLE代表可用</span>
<span class=nx>AGE创建至今运行的时长</span>
</code></pre></td></tr></table></div></div><p>\4. 查看Deployment的详情，可以看到Deployment通过一个deployment-nginx-demo-866bb6cf78 replicaset副本控制器控制Pod的副本数量</p><p><img src=https://agou-images.oss-cn-qingdao.aliyuncs.com/blog-images/k8s%E5%9F%BA%E7%A1%80/kubernetes%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8B%EF%BC%88%E5%8D%81%E4%B8%80%EF%BC%89%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0Deployment%E6%8E%A7%E5%88%B6%E5%99%A8/1%20-%201620.jpg alt=Deployment详情信息></p><p>\5. 查看replicaset的详情信息，通过Events可查看到deployment-nginx-demo-866bb6cf78创建了三个Pod</p><p><img src=https://agou-images.oss-cn-qingdao.aliyuncs.com/blog-images/k8s%E5%9F%BA%E7%A1%80/kubernetes%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8B%EF%BC%88%E5%8D%81%E4%B8%80%EF%BC%89%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0Deployment%E6%8E%A7%E5%88%B6%E5%99%A8/2%20-%201620.jpg alt=ReplicaSet详情信息></p><p>\6. 查看Pod详情，最终通过Pod定义的模版创建container，资源定义，健康检查等包含在Pod定义的模版中</p><p><img src=https://agou-images.oss-cn-qingdao.aliyuncs.com/blog-images/k8s%E5%9F%BA%E7%A1%80/kubernetes%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8B%EF%BC%88%E5%8D%81%E4%B8%80%EF%BC%89%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0Deployment%E6%8E%A7%E5%88%B6%E5%99%A8/3%20-%201620.jpg alt=Pod详情信息></p><p>通过上面的实战演练我们可得知Deployment的副本控制功能是由replicaset实现，replicaset生成Deployment中定义的replicas副本的数量，即创建多个副本，如下图所示：</p><p><img src=https://agou-images.oss-cn-qingdao.aliyuncs.com/blog-images/k8s%E5%9F%BA%E7%A1%80/kubernetes%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8B%EF%BC%88%E5%8D%81%E4%B8%80%EF%BC%89%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0Deployment%E6%8E%A7%E5%88%B6%E5%99%A8/4%20-%201620.jpg alt=Deployment创建结构示意图></p><h3 id=122-deployment扩容>1.2.2 Deployment扩容</h3><p>当业务比较繁忙时可以通过增加副本数，增加副本数是通过yaml文件中的replicas控制的，当设置了replias后，Deployment控制器会自动根据当前副本数目创建所需的Pod数，这些pod会自动加入到service中实现负载均衡，相反减少副本数，这些pod会自动从service中删除。</p><p><img src=https://agou-images.oss-cn-qingdao.aliyuncs.com/blog-images/k8s%E5%9F%BA%E7%A1%80/kubernetes%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8B%EF%BC%88%E5%8D%81%E4%B8%80%EF%BC%89%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0Deployment%E6%8E%A7%E5%88%B6%E5%99%A8/5%20-%201620.jpg alt=Deployment扩容></p><p>\1. 将deployment的副本数扩容至4个，可通过修改yaml文件的replicas个数或者通过scale命令扩展。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-js data-lang=js><span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=o>~</span><span class=p>]</span><span class=err>#</span> <span class=nx>kubectl</span> <span class=nx>scale</span> <span class=o>--</span><span class=nx>replicas</span><span class=o>=</span><span class=mi>4</span> <span class=nx>deployment</span> <span class=nx>deployment</span><span class=o>-</span><span class=nx>nginx</span><span class=o>-</span><span class=nx>demo</span> 
<span class=nx>deployment</span><span class=p>.</span><span class=nx>extensions</span><span class=o>/</span><span class=nx>deployment</span><span class=o>-</span><span class=nx>nginx</span><span class=o>-</span><span class=nx>demo</span> <span class=nx>scaled</span>
</code></pre></td></tr></table></div></div><p>\2. 查看Deployment副本数量,已增加至4个副本</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-js data-lang=js><span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=o>~</span><span class=p>]</span><span class=err>#</span> <span class=nx>kubectl</span> <span class=nx>get</span> <span class=nx>deployments</span>
<span class=nx>NAME</span>                    <span class=nx>READY</span>   <span class=nx>UP</span><span class=o>-</span><span class=nx>TO</span><span class=o>-</span><span class=nx>DATE</span>   <span class=nx>AVAILABLE</span>   <span class=nx>AGE</span>
<span class=nx>deployment</span><span class=o>-</span><span class=nx>nginx</span><span class=o>-</span><span class=nx>demo</span>   <span class=mi>4</span><span class=o>/</span><span class=mi>4</span>     <span class=mi>4</span>            <span class=mi>4</span>           <span class=mi>77</span><span class=nx>m</span>
</code></pre></td></tr></table></div></div><p>\3. 副本的扩容是如何实现的呢？我们查看replicaset的详情信息观察，增加副本的个数是通过replicaset来扩容，通过模版复制新的Pod</p><p><img src=https://agou-images.oss-cn-qingdao.aliyuncs.com/blog-images/k8s%E5%9F%BA%E7%A1%80/kubernetes%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8B%EF%BC%88%E5%8D%81%E4%B8%80%EF%BC%89%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0Deployment%E6%8E%A7%E5%88%B6%E5%99%A8/6%20-%201620.jpg alt=Deployment扩展></p><p>\4. 副本缩容</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-js data-lang=js><span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=o>~</span><span class=p>]</span><span class=err>#</span> <span class=nx>kubectl</span> <span class=nx>scale</span> <span class=o>--</span><span class=nx>replicas</span><span class=o>=</span><span class=mi>2</span> <span class=nx>deployment</span> <span class=nx>deployment</span><span class=o>-</span><span class=nx>nginx</span><span class=o>-</span><span class=nx>demo</span> 
<span class=nx>deployment</span><span class=p>.</span><span class=nx>extensions</span><span class=o>/</span><span class=nx>deployment</span><span class=o>-</span><span class=nx>nginx</span><span class=o>-</span><span class=nx>demo</span> <span class=nx>scaled</span>

<span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=o>~</span><span class=p>]</span><span class=err>#</span> <span class=nx>kubectl</span> <span class=nx>get</span> <span class=nx>deployments</span> <span class=nx>deployment</span><span class=o>-</span><span class=nx>nginx</span><span class=o>-</span><span class=nx>demo</span> 
<span class=nx>NAME</span>                    <span class=nx>READY</span>   <span class=nx>UP</span><span class=o>-</span><span class=nx>TO</span><span class=o>-</span><span class=nx>DATE</span>   <span class=nx>AVAILABLE</span>   <span class=nx>AGE</span>
<span class=nx>deployment</span><span class=o>-</span><span class=nx>nginx</span><span class=o>-</span><span class=nx>demo</span>   <span class=mi>2</span><span class=o>/</span><span class=mi>2</span>     <span class=mi>2</span>            <span class=mi>2</span>           <span class=mi>7</span><span class=nx>h41m</span>
</code></pre></td></tr></table></div></div><p><img src=https://agou-images.oss-cn-qingdao.aliyuncs.com/blog-images/k8s%E5%9F%BA%E7%A1%80/kubernetes%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8B%EF%BC%88%E5%8D%81%E4%B8%80%EF%BC%89%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0Deployment%E6%8E%A7%E5%88%B6%E5%99%A8/7%20-%201620.jpg alt=Deployment减少副本></p><p>通过上面的操作演练我们可以得知:Deployment的扩容是通过ReplicaSet的模版创建Pod或删除Pod实现，scale是手动扩展实现副本的机制，kubernetes还提供了另外一种副本自动扩容机制horizontalpodautoscalers(Horizontal Pod Autoscaling),即通过定义CPU的利用率实现自动的横向扩展，由于需要依赖于监控组件，后续我们再做介绍。</p><h3 id=123-滚动更新>1.2.3 滚动更新</h3><p>Deployment支持滚动更新，默认创建Deployment后会增加滚动更新的策略，通过逐步替代replicas中的pod实现更新无服务中断（需要结合service），如下图所示：将一个deployment副本数为3的应用更新，先更新10.0.0.6 pod，更新pod应用，替换新的ip，然后加入到service中，以此类推再继续更新其他pod，从而实现滚动更新，不影响服务的升级。</p><p><img src=https://agou-images.oss-cn-qingdao.aliyuncs.com/blog-images/k8s%E5%9F%BA%E7%A1%80/kubernetes%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8B%EF%BC%88%E5%8D%81%E4%B8%80%EF%BC%89%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0Deployment%E6%8E%A7%E5%88%B6%E5%99%A8/8%20-%201620.jpg alt=滚动更新></p><p>通过类型为：RollingUpdate，每次更新最大的数量maxSurge是replicas总数的25%,最大不可用的数量maxUnavailable为25%，如下是通过kubectl get deployments deployment-nginx-demo -o yaml查看滚动更新相关的策略。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-js data-lang=js><span class=nx>spec</span><span class=o>:</span>
  <span class=nx>progressDeadlineSeconds</span><span class=o>:</span> <span class=mi>600</span>
  <span class=nx>replicas</span><span class=o>:</span> <span class=mi>3</span>
  <span class=nx>revisionHistoryLimit</span><span class=o>:</span> <span class=mi>10</span>
  <span class=nx>selector</span><span class=o>:</span>
    <span class=nx>matchLabels</span><span class=o>:</span>
      <span class=nx>app</span><span class=o>:</span> <span class=nx>nginx</span>
      <span class=nx>rc</span><span class=o>:</span> <span class=nx>deployment</span>
  <span class=nx>strategy</span><span class=o>:</span>  <span class=err>#</span><span class=nx>strategy定义的是升级的策略</span><span class=err>，</span><span class=nx>类型为RollingUpdate</span>
    <span class=nx>rollingUpdate</span><span class=o>:</span> 
      <span class=nx>maxSurge</span><span class=o>:</span> <span class=mi>25</span><span class=o>%</span>
      <span class=nx>maxUnavailable</span><span class=o>:</span> <span class=mi>25</span><span class=o>%</span>
    <span class=nx>type</span><span class=o>:</span> <span class=nx>RollingUpdate</span>
</code></pre></td></tr></table></div></div><p>\1. 滚动更新是当pod.template中定义的相关属性变化，如下将镜像更新到1.9.1，通过&ndash;record会记录操作命令</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-js data-lang=js><span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=o>~</span><span class=p>]</span><span class=err>#</span> <span class=nx>kubectl</span> <span class=nx>set</span> <span class=nx>image</span> <span class=nx>deployments</span> <span class=nx>deployment</span><span class=o>-</span><span class=nx>nginx</span><span class=o>-</span><span class=nx>demo</span> <span class=nx>nginx</span><span class=o>-</span><span class=nx>deployment</span><span class=o>=</span><span class=nx>nginx</span><span class=o>:</span><span class=mf>1.9.1</span> <span class=o>--</span><span class=nx>record</span>
<span class=nx>deployment</span><span class=p>.</span><span class=nx>extensions</span><span class=o>/</span><span class=nx>deployment</span><span class=o>-</span><span class=nx>nginx</span><span class=o>-</span><span class=nx>demo</span> <span class=nx>image</span> <span class=nx>updated</span>
</code></pre></td></tr></table></div></div><p>\2. 查看滚动升级的状态（由于第一次nginx的镜像写错了，容器下载镜像失败，写成nignx，导致修改后有两次record）</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-js data-lang=js><span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=nx>happylau</span><span class=p>]</span><span class=err>#</span> <span class=nx>kubectl</span> <span class=nx>rollout</span> <span class=nx>status</span> <span class=nx>deployment</span> <span class=nx>deployment</span><span class=o>-</span><span class=nx>nginx</span><span class=o>-</span><span class=nx>demo</span> 
<span class=nx>deployment</span> <span class=s2>&#34;deployment-nginx-demo&#34;</span> <span class=nx>successfully</span> <span class=nx>rolled</span> <span class=nx>out</span>

<span class=nx>查看滚动升级版本</span><span class=err>，</span><span class=nx>REVSISION代表版本号</span><span class=err>：</span>
<span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=nx>happylau</span><span class=p>]</span><span class=err>#</span> <span class=nx>kubectl</span> <span class=nx>rollout</span> <span class=nx>history</span> <span class=nx>deployment</span> <span class=nx>deployment</span><span class=o>-</span><span class=nx>nginx</span><span class=o>-</span><span class=nx>demo</span> 
<span class=nx>deployment</span><span class=p>.</span><span class=nx>extensions</span><span class=o>/</span><span class=nx>deployment</span><span class=o>-</span><span class=nx>nginx</span><span class=o>-</span><span class=nx>demo</span> 
<span class=nx>REVISION</span>  <span class=nx>CHANGE</span><span class=o>-</span><span class=nx>CAUSE</span>
<span class=mi>1</span>         <span class=o>&lt;</span><span class=nx>none</span><span class=o>&gt;</span>
<span class=mi>2</span>         <span class=nx>kubectl</span> <span class=nx>set</span> <span class=nx>image</span> <span class=nx>deployments</span> <span class=nx>deployment</span><span class=o>-</span><span class=nx>nginx</span><span class=o>-</span><span class=nx>demo</span> <span class=nx>nginx</span><span class=o>-</span><span class=nx>deployment</span><span class=o>=</span><span class=nx>nignx</span><span class=o>:</span><span class=mf>1.9.1</span> <span class=o>--</span><span class=nx>record</span><span class=o>=</span><span class=kc>true</span>
<span class=mi>3</span>         <span class=nx>kubectl</span> <span class=nx>set</span> <span class=nx>image</span> <span class=nx>deployments</span> <span class=nx>deployment</span><span class=o>-</span><span class=nx>nginx</span><span class=o>-</span><span class=nx>demo</span> <span class=nx>nginx</span><span class=o>-</span><span class=nx>deployment</span><span class=o>=</span><span class=nx>nignx</span><span class=o>:</span><span class=mf>1.9.1</span> <span class=o>--</span><span class=nx>record</span><span class=o>=</span><span class=kc>true</span>
</code></pre></td></tr></table></div></div><p>\3. 观察Deployment的升级过程，新创建一个RS deployment-nginx-demo-65c8c98c7b，逐渐将旧RS中的pod替换，直至旧的RS deployment-nginx-demo-866bb6cf78上的副本数为0.</p><p><img src=https://agou-images.oss-cn-qingdao.aliyuncs.com/blog-images/k8s%E5%9F%BA%E7%A1%80/kubernetes%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8B%EF%BC%88%E5%8D%81%E4%B8%80%EF%BC%89%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0Deployment%E6%8E%A7%E5%88%B6%E5%99%A8/9%20-%201620.jpg alt=滚动升级原理></p><p>\4. 查看RS的列表，可以看到新的RS的副本数为2，其他RS副本数为0</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-js data-lang=js><span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=o>~</span><span class=p>]</span><span class=err>#</span> <span class=nx>kubectl</span> <span class=nx>get</span> <span class=nx>replicasets</span> 
<span class=nx>NAME</span>                               <span class=nx>DESIRED</span>   <span class=nx>CURRENT</span>   <span class=nx>READY</span>   <span class=nx>AGE</span>
<span class=nx>deployment</span><span class=o>-</span><span class=nx>nginx</span><span class=o>-</span><span class=nx>demo</span><span class=o>-</span><span class=mi>65</span><span class=nx>c8c98c7b</span>   <span class=mi>2</span>         <span class=mi>2</span>         <span class=mi>2</span>       <span class=mi>21</span><span class=nx>m</span>  <span class=err>#</span><span class=nx>新的RS</span><span class=err>，</span><span class=nx>REVSION为3</span>
<span class=nx>deployment</span><span class=o>-</span><span class=nx>nginx</span><span class=o>-</span><span class=nx>demo</span><span class=o>-</span><span class=mi>6</span><span class=nx>cb65f58c6</span>   <span class=mi>0</span>         <span class=mi>0</span>         <span class=mi>0</span>       <span class=mi>22</span><span class=nx>m</span>  <span class=err>#</span><span class=nx>镜像写错的RS</span><span class=err>，</span><span class=nx>REVISON为2</span>
<span class=nx>deployment</span><span class=o>-</span><span class=nx>nginx</span><span class=o>-</span><span class=nx>demo</span><span class=o>-</span><span class=mi>866</span><span class=nx>bb6cf78</span>   <span class=mi>0</span>         <span class=mi>0</span>         <span class=mi>0</span>       <span class=mi>40</span><span class=nx>m</span>  <span class=err>#</span><span class=nx>旧的RS</span><span class=err>，</span><span class=nx>对应REVSION为1</span>
</code></pre></td></tr></table></div></div><p>\5. 测试版本升级是否成功</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-js data-lang=js><span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=o>~</span><span class=p>]</span><span class=err>#</span> <span class=nx>kubectl</span> <span class=nx>get</span> <span class=nx>pods</span> <span class=o>-</span><span class=nx>o</span> <span class=nx>wide</span> 
<span class=nx>NAME</span>                                     <span class=nx>READY</span>   <span class=nx>STATUS</span>    <span class=nx>RESTARTS</span>   <span class=nx>AGE</span>   <span class=nx>IP</span>            <span class=nx>NODE</span>     <span class=nx>NOMINATED</span> <span class=nx>NODE</span>   <span class=nx>READINESS</span> <span class=nx>GATES</span>
<span class=nx>deployment</span><span class=o>-</span><span class=nx>nginx</span><span class=o>-</span><span class=nx>demo</span><span class=o>-</span><span class=mi>65</span><span class=nx>c8c98c7b</span><span class=o>-</span><span class=nx>bzql9</span>   <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=nx>Running</span>   <span class=mi>0</span>          <span class=mi>25</span><span class=nx>m</span>   <span class=mf>10.244.1.58</span>   <span class=nx>node</span><span class=o>-</span><span class=mi>2</span>   <span class=o>&lt;</span><span class=nx>none</span><span class=o>&gt;</span>           <span class=o>&lt;</span><span class=nx>none</span><span class=o>&gt;</span>
<span class=nx>deployment</span><span class=o>-</span><span class=nx>nginx</span><span class=o>-</span><span class=nx>demo</span><span class=o>-</span><span class=mi>65</span><span class=nx>c8c98c7b</span><span class=o>-</span><span class=nx>vrjhp</span>   <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=nx>Running</span>   <span class=mi>0</span>          <span class=mi>25</span><span class=nx>m</span>   <span class=mf>10.244.2.72</span>   <span class=nx>node</span><span class=o>-</span><span class=mi>3</span>   <span class=o>&lt;</span><span class=nx>none</span><span class=o>&gt;</span>           <span class=o>&lt;</span><span class=nx>none</span><span class=o>&gt;</span>
<span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=o>~</span><span class=p>]</span><span class=err>#</span> <span class=nx>curl</span> <span class=o>-</span><span class=nx>I</span> <span class=nx>http</span><span class=o>:</span><span class=c1>//10.244.2.72 
</span><span class=c1></span><span class=nx>HTTP</span><span class=o>/</span><span class=mf>1.1</span> <span class=mi>200</span> <span class=nx>OK</span>
<span class=nx>Server</span><span class=o>:</span> <span class=nx>nginx</span><span class=o>/</span><span class=mf>1.9.1</span> <span class=err>#</span><span class=nx>镜像的版本成功更新</span>
<span class=nb>Date</span><span class=o>:</span> <span class=nx>Mon</span><span class=p>,</span> <span class=mi>28</span> <span class=nx>Oct</span> <span class=mi>2019</span> <span class=mi>15</span><span class=o>:</span><span class=mi>28</span><span class=o>:</span><span class=mi>49</span> <span class=nx>GMT</span>
<span class=nx>Content</span><span class=o>-</span><span class=nx>Type</span><span class=o>:</span> <span class=nx>text</span><span class=o>/</span><span class=nx>html</span>
<span class=nx>Content</span><span class=o>-</span><span class=nx>Length</span><span class=o>:</span> <span class=mi>612</span>
<span class=nx>Last</span><span class=o>-</span><span class=nx>Modified</span><span class=o>:</span> <span class=nx>Tue</span><span class=p>,</span> <span class=mi>26</span> <span class=nx>May</span> <span class=mi>2015</span> <span class=mi>15</span><span class=o>:</span><span class=mi>02</span><span class=o>:</span><span class=mi>09</span> <span class=nx>GMT</span>
<span class=nx>Connection</span><span class=o>:</span> <span class=nx>keep</span><span class=o>-</span><span class=nx>alive</span>
<span class=nx>ETag</span><span class=o>:</span> <span class=s2>&#34;55648af1-264&#34;</span>
<span class=nx>Accept</span><span class=o>-</span><span class=nx>Ranges</span><span class=o>:</span> <span class=nx>bytes</span>
</code></pre></td></tr></table></div></div><h3 id=124-版本回退>1.2.4 版本回退</h3><p>如果版本不符合预期，kubernetes提供回退的功能，和滚动更新一样，回退的功能Deployment将替换到原始的RS上，即逐步将Pod的副本替换到旧的RS上.</p><p>\1. 执行回滚，回退到REVISON版本为1</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-js data-lang=js><span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=o>~</span><span class=p>]</span><span class=err>#</span> <span class=nx>kubectl</span> <span class=nx>rollout</span> <span class=nx>undo</span> <span class=nx>deployment</span> <span class=nx>deployment</span><span class=o>-</span><span class=nx>nginx</span><span class=o>-</span><span class=nx>demo</span> <span class=o>--</span><span class=nx>to</span><span class=o>-</span><span class=nx>revision</span><span class=o>=</span><span class=mi>1</span>
<span class=nx>deployment</span><span class=p>.</span><span class=nx>extensions</span><span class=o>/</span><span class=nx>deployment</span><span class=o>-</span><span class=nx>nginx</span><span class=o>-</span><span class=nx>demo</span> <span class=nx>rolled</span> <span class=nx>back</span>
</code></pre></td></tr></table></div></div><p>\2. 查看Deployment的回退状态和历史版本</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-js data-lang=js><span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=o>~</span><span class=p>]</span><span class=err>#</span> <span class=nx>kubectl</span> <span class=nx>rollout</span> <span class=nx>status</span> <span class=nx>deployment</span> <span class=nx>deployment</span><span class=o>-</span><span class=nx>nginx</span><span class=o>-</span><span class=nx>demo</span> 
<span class=nx>deployment</span> <span class=s2>&#34;deployment-nginx-demo&#34;</span> <span class=nx>successfully</span> <span class=nx>rolled</span> <span class=nx>out</span>

<span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=o>~</span><span class=p>]</span><span class=err>#</span> <span class=nx>kubectl</span> <span class=nx>rollout</span> <span class=nx>history</span> <span class=nx>deployment</span> <span class=nx>deployment</span><span class=o>-</span><span class=nx>nginx</span><span class=o>-</span><span class=nx>demo</span> 
<span class=nx>deployment</span><span class=p>.</span><span class=nx>extensions</span><span class=o>/</span><span class=nx>deployment</span><span class=o>-</span><span class=nx>nginx</span><span class=o>-</span><span class=nx>demo</span> 
<span class=nx>REVISION</span>  <span class=nx>CHANGE</span><span class=o>-</span><span class=nx>CAUSE</span>
<span class=mi>2</span>         <span class=nx>kubectl</span> <span class=nx>set</span> <span class=nx>image</span> <span class=nx>deployments</span> <span class=nx>deployment</span><span class=o>-</span><span class=nx>nginx</span><span class=o>-</span><span class=nx>demo</span> <span class=nx>nginx</span><span class=o>-</span><span class=nx>deployment</span><span class=o>=</span><span class=nx>nignx</span><span class=o>:</span><span class=mf>1.9.1</span> <span class=o>--</span><span class=nx>record</span><span class=o>=</span><span class=kc>true</span>
<span class=mi>3</span>         <span class=nx>kubectl</span> <span class=nx>set</span> <span class=nx>image</span> <span class=nx>deployments</span> <span class=nx>deployment</span><span class=o>-</span><span class=nx>nginx</span><span class=o>-</span><span class=nx>demo</span> <span class=nx>nginx</span><span class=o>-</span><span class=nx>deployment</span><span class=o>=</span><span class=nx>nignx</span><span class=o>:</span><span class=mf>1.9.1</span> <span class=o>--</span><span class=nx>record</span><span class=o>=</span><span class=kc>true</span>
<span class=mi>4</span>         <span class=o>&lt;</span><span class=nx>none</span><span class=o>&gt;</span>
</code></pre></td></tr></table></div></div><p>\3. 查看Deployment的详情，可以看到RS已经会退到原始的RS了</p><p><img src=https://agou-images.oss-cn-qingdao.aliyuncs.com/blog-images/k8s%E5%9F%BA%E7%A1%80/kubernetes%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8B%EF%BC%88%E5%8D%81%E4%B8%80%EF%BC%89%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0Deployment%E6%8E%A7%E5%88%B6%E5%99%A8/10%20-%201620.jpg alt=版本回退></p><p>\4. 测试nginx的版本</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-js data-lang=js><span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=o>~</span><span class=p>]</span><span class=err>#</span> <span class=nx>kubectl</span> <span class=nx>get</span> <span class=nx>pods</span> <span class=o>-</span><span class=nx>o</span> <span class=nx>wide</span> 
<span class=nx>NAME</span>                                     <span class=nx>READY</span>   <span class=nx>STATUS</span>    <span class=nx>RESTARTS</span>   <span class=nx>AGE</span>     <span class=nx>IP</span>            <span class=nx>NODE</span>     <span class=nx>NOMINATED</span> <span class=nx>NODE</span>   <span class=nx>READINESS</span> <span class=nx>GATES</span>
<span class=nx>deployment</span><span class=o>-</span><span class=nx>nginx</span><span class=o>-</span><span class=nx>demo</span><span class=o>-</span><span class=mi>866</span><span class=nx>bb6cf78</span><span class=o>-</span><span class=mi>9</span><span class=nx>thtn</span>   <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=nx>Running</span>   <span class=mi>0</span>          <span class=mi>3</span><span class=nx>m42s</span>   <span class=mf>10.244.1.59</span>   <span class=nx>node</span><span class=o>-</span><span class=mi>2</span>   <span class=o>&lt;</span><span class=nx>none</span><span class=o>&gt;</span>           <span class=o>&lt;</span><span class=nx>none</span><span class=o>&gt;</span>
<span class=nx>deployment</span><span class=o>-</span><span class=nx>nginx</span><span class=o>-</span><span class=nx>demo</span><span class=o>-</span><span class=mi>866</span><span class=nx>bb6cf78</span><span class=o>-</span><span class=nx>ws2hx</span>   <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=nx>Running</span>   <span class=mi>0</span>          <span class=mi>3</span><span class=nx>m48s</span>   <span class=mf>10.244.2.73</span>   <span class=nx>node</span><span class=o>-</span><span class=mi>3</span>   <span class=o>&lt;</span><span class=nx>none</span><span class=o>&gt;</span>           <span class=o>&lt;</span><span class=nx>none</span><span class=o>&gt;</span>


<span class=err>#</span><span class=nx>测试版本</span>
<span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=o>~</span><span class=p>]</span><span class=err>#</span> <span class=nx>curl</span> <span class=o>-</span><span class=nx>I</span> <span class=nx>http</span><span class=o>:</span><span class=c1>//10.244.1.59 
</span><span class=c1></span><span class=nx>HTTP</span><span class=o>/</span><span class=mf>1.1</span> <span class=mi>200</span> <span class=nx>OK</span>
<span class=nx>Server</span><span class=o>:</span> <span class=nx>nginx</span><span class=o>/</span><span class=mf>1.7.9</span> <span class=err>#</span><span class=nx>回退到1</span><span class=mf>.7.9</span><span class=nx>版本</span>
<span class=nb>Date</span><span class=o>:</span> <span class=nx>Mon</span><span class=p>,</span> <span class=mi>28</span> <span class=nx>Oct</span> <span class=mi>2019</span> <span class=mi>15</span><span class=o>:</span><span class=mi>36</span><span class=o>:</span><span class=mi>07</span> <span class=nx>GMT</span>
<span class=nx>Content</span><span class=o>-</span><span class=nx>Type</span><span class=o>:</span> <span class=nx>text</span><span class=o>/</span><span class=nx>html</span>
<span class=nx>Content</span><span class=o>-</span><span class=nx>Length</span><span class=o>:</span> <span class=mi>612</span>
<span class=nx>Last</span><span class=o>-</span><span class=nx>Modified</span><span class=o>:</span> <span class=nx>Tue</span><span class=p>,</span> <span class=mi>23</span> <span class=nx>Dec</span> <span class=mi>2014</span> <span class=mi>16</span><span class=o>:</span><span class=mi>25</span><span class=o>:</span><span class=mi>09</span> <span class=nx>GMT</span>
<span class=nx>Connection</span><span class=o>:</span> <span class=nx>keep</span><span class=o>-</span><span class=nx>alive</span>
<span class=nx>ETag</span><span class=o>:</span> <span class=s2>&#34;54999765-264&#34;</span>
<span class=nx>Accept</span><span class=o>-</span><span class=nx>Ranges</span><span class=o>:</span> <span class=nx>bytes</span>
</code></pre></td></tr></table></div></div><p><strong>小结</strong>：通过上面的操作演练可知，Deployment是通过ReplicaSet实现Pod副本数的管理（扩容或减少副本数），滚动更新是通过新建RS，将Pod从旧的RS逐步更新到新的RS上；相反，回滚版本将会退到指定版本的ReplicaSet上。</p><h2 id=13-replicaset>1.3 ReplicaSet</h2><p>ReplicaSet副本集简称RS，用于实现副本数的控制，通过上面的学习我们可以知道Deployment实际是调用ReplicaSet实现副本的控制，RS不具备滚动升级和回滚的特性，一般推荐使用Deployment，ReplicaSet的定义和Deployment差不多，如下：</p><p>\1. 定义ReplicaSet</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-js data-lang=js><span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=nx>happylau</span><span class=p>]</span><span class=err>#</span> <span class=nx>cat</span> <span class=nx>replicaset</span><span class=o>-</span><span class=nx>demo</span><span class=p>.</span><span class=nx>yaml</span> 
<span class=nx>apiVersion</span><span class=o>:</span> <span class=nx>extensions</span><span class=o>/</span><span class=nx>v1beta1</span>
<span class=nx>kind</span><span class=o>:</span> <span class=nx>ReplicaSet</span>
<span class=nx>metadata</span><span class=o>:</span>
  <span class=nx>name</span><span class=o>:</span> <span class=nx>replicaset</span><span class=o>-</span><span class=nx>demo</span>
  <span class=nx>labels</span><span class=o>:</span>
    <span class=nx>controller</span><span class=o>:</span> <span class=nx>replicaset</span>
  <span class=nx>annotations</span><span class=o>:</span>
    <span class=nx>kubernetes</span><span class=p>.</span><span class=nx>io</span><span class=o>/</span><span class=nx>description</span><span class=o>:</span> <span class=s2>&#34;Kubernetes Replication Controller Replication&#34;</span>
<span class=nx>spec</span><span class=o>:</span>
  <span class=nx>replicas</span><span class=o>:</span> <span class=mi>3</span>    <span class=err>#</span><span class=nx>副本数</span>
  <span class=nx>selector</span><span class=o>:</span>      <span class=err>#</span><span class=nx>Pod标签选择器</span>
    <span class=nx>matchLabels</span><span class=o>:</span>  
      <span class=nx>controller</span><span class=o>:</span> <span class=nx>replicaset</span>
  <span class=nx>template</span><span class=o>:</span>      <span class=err>#</span><span class=nx>创建Pod的模板</span>
    <span class=nx>metadata</span><span class=o>:</span>
      <span class=nx>labels</span><span class=o>:</span>
        <span class=nx>controller</span><span class=o>:</span> <span class=nx>replicaset</span>
    <span class=nx>spec</span><span class=o>:</span>        <span class=err>#</span><span class=nx>容器信息</span>
      <span class=nx>containers</span><span class=o>:</span>
      <span class=o>-</span> <span class=nx>name</span><span class=o>:</span> <span class=nx>nginx</span><span class=o>-</span><span class=nx>replicaset</span><span class=o>-</span><span class=nx>demo</span>
        <span class=nx>image</span><span class=o>:</span> <span class=nx>nginx</span><span class=o>:</span><span class=mf>1.7.9</span>
        <span class=nx>imagePullPolicy</span><span class=o>:</span> <span class=nx>IfNotPresent</span>
        <span class=nx>ports</span><span class=o>:</span>
        <span class=o>-</span> <span class=nx>name</span><span class=o>:</span> <span class=nx>http</span><span class=o>-</span><span class=mi>80</span><span class=o>-</span><span class=nx>port</span>
          <span class=nx>protocol</span><span class=o>:</span> <span class=nx>TCP</span>
          <span class=nx>containerPort</span><span class=o>:</span> <span class=mi>80</span>
</code></pre></td></tr></table></div></div><p>\2. 创建RS并查看RS列表</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-js data-lang=js><span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=nx>happylau</span><span class=p>]</span><span class=err>#</span> <span class=nx>kubectl</span> <span class=nx>apply</span> <span class=o>-</span><span class=nx>f</span> <span class=nx>replicaset</span><span class=o>-</span><span class=nx>demo</span><span class=p>.</span><span class=nx>yaml</span> 
<span class=nx>replicaset</span><span class=p>.</span><span class=nx>extensions</span><span class=o>/</span><span class=nx>replicaset</span><span class=o>-</span><span class=nx>demo</span> <span class=nx>created</span>

<span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=nx>happylau</span><span class=p>]</span><span class=err>#</span> <span class=nx>kubectl</span> <span class=nx>get</span> <span class=nx>replicasets</span> <span class=nx>replicaset</span><span class=o>-</span><span class=nx>demo</span> 
<span class=nx>NAME</span>              <span class=nx>DESIRED</span>   <span class=nx>CURRENT</span>   <span class=nx>READY</span>   <span class=nx>AGE</span>
<span class=nx>replicaset</span><span class=o>-</span><span class=nx>demo</span>   <span class=mi>3</span>         <span class=mi>3</span>         <span class=mi>3</span>       <span class=mi>15</span><span class=nx>s</span>
</code></pre></td></tr></table></div></div><p>\3. 扩展副本数至4个</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-js data-lang=js><span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=nx>happylau</span><span class=p>]</span><span class=err>#</span> <span class=nx>kubectl</span> <span class=nx>scale</span> <span class=o>--</span><span class=nx>replicas</span><span class=o>=</span><span class=mi>4</span> <span class=nx>replicaset</span> <span class=nx>replicaset</span><span class=o>-</span><span class=nx>demo</span> 
<span class=nx>replicaset</span><span class=p>.</span><span class=nx>extensions</span><span class=o>/</span><span class=nx>replicaset</span><span class=o>-</span><span class=nx>demo</span> <span class=nx>scaled</span>
<span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=nx>happylau</span><span class=p>]</span><span class=err>#</span> <span class=nx>kubectl</span> <span class=nx>get</span> <span class=nx>replicasets</span> <span class=nx>replicaset</span><span class=o>-</span><span class=nx>demo</span> 
<span class=nx>NAME</span>              <span class=nx>DESIRED</span>   <span class=nx>CURRENT</span>   <span class=nx>READY</span>   <span class=nx>AGE</span>
<span class=nx>replicaset</span><span class=o>-</span><span class=nx>demo</span>   <span class=mi>4</span>         <span class=mi>4</span>         <span class=mi>4</span>       <span class=mi>76</span><span class=nx>s</span>
</code></pre></td></tr></table></div></div><p>\4. 减少副本数至2个</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-js data-lang=js><span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=nx>happylau</span><span class=p>]</span><span class=err>#</span> <span class=nx>kubectl</span> <span class=nx>scale</span> <span class=o>--</span><span class=nx>replicas</span><span class=o>=</span><span class=mi>2</span> <span class=nx>replicaset</span> <span class=nx>replicaset</span><span class=o>-</span><span class=nx>demo</span> 
<span class=nx>replicaset</span><span class=p>.</span><span class=nx>extensions</span><span class=o>/</span><span class=nx>replicaset</span><span class=o>-</span><span class=nx>demo</span> <span class=nx>scaled</span>
<span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=nx>happylau</span><span class=p>]</span><span class=err>#</span> <span class=nx>kubectl</span> <span class=nx>get</span> <span class=nx>replicasets</span> <span class=nx>replicaset</span><span class=o>-</span><span class=nx>demo</span> 
<span class=nx>NAME</span>              <span class=nx>DESIRED</span>   <span class=nx>CURRENT</span>   <span class=nx>READY</span>   <span class=nx>AGE</span>
<span class=nx>replicaset</span><span class=o>-</span><span class=nx>demo</span>   <span class=mi>2</span>         <span class=mi>2</span>         <span class=mi>2</span>       <span class=mi>114</span><span class=nx>s</span>
</code></pre></td></tr></table></div></div><p>\5. 镜像版本升级，验证得知不具备版本升级的能力</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-js data-lang=js><span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=nx>happylau</span><span class=p>]</span><span class=err>#</span> <span class=nx>kubectl</span> <span class=nx>set</span> <span class=nx>image</span> <span class=nx>replicasets</span> <span class=nx>replicaset</span><span class=o>-</span><span class=nx>demo</span> <span class=nx>nginx</span><span class=o>-</span><span class=nx>replicaset</span><span class=o>-</span><span class=nx>demo</span><span class=o>=</span><span class=nx>nginx</span><span class=o>:</span><span class=mf>1.9.1</span>
<span class=nx>replicaset</span><span class=p>.</span><span class=nx>extensions</span><span class=o>/</span><span class=nx>replicaset</span><span class=o>-</span><span class=nx>demo</span> <span class=nx>image</span> <span class=nx>updated</span>  <span class=err>#</span><span class=nx>命令执行成功了</span>
</code></pre></td></tr></table></div></div><p><img src=https://agou-images.oss-cn-qingdao.aliyuncs.com/blog-images/k8s%E5%9F%BA%E7%A1%80/kubernetes%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8B%EF%BC%88%E5%8D%81%E4%B8%80%EF%BC%89%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0Deployment%E6%8E%A7%E5%88%B6%E5%99%A8/11%20-%201620.jpg alt=ReplicaSet验证版本更新></p><p>ReplicaSet小结：通过上面的演示可以知道，RS定义和Deployment类似，能实现副本的控制，扩展和缩减，Deployment是更高层次的副本控制器，ReplicaSet主要为Deployment的副本控制器和滚动更新机制，ReplicaSet本身无法提供滚动更新的能力。</p><h2 id=14-replicationcontroller>1.4 ReplicationController</h2><p>ReplicationController副本控制器简称RC，是kubernetes中最早的副本控制器，RC是ReplicaSet之前的版本，ReplicationController提供副本控制能力，其定义方式和Deployment，ReplicaSet相类似，如下：</p><p>\1. 定义ReplicationController</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-js data-lang=js><span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=nx>happylau</span><span class=p>]</span><span class=err>#</span> <span class=nx>cat</span> <span class=nx>rc</span><span class=o>-</span><span class=nx>demo</span><span class=p>.</span><span class=nx>yaml</span> 
<span class=nx>apiVersion</span><span class=o>:</span> <span class=nx>v1</span> 
<span class=nx>kind</span><span class=o>:</span> <span class=nx>ReplicationController</span> 
<span class=nx>metadata</span><span class=o>:</span>
  <span class=nx>name</span><span class=o>:</span> <span class=nx>rc</span><span class=o>-</span><span class=nx>demo</span> 
  <span class=nx>labels</span><span class=o>:</span>
    <span class=nx>controller</span><span class=o>:</span> <span class=nx>replicationcontroller</span> 
  <span class=nx>annotations</span><span class=o>:</span>
    <span class=nx>kubernetes</span><span class=p>.</span><span class=nx>io</span><span class=o>/</span><span class=nx>description</span><span class=o>:</span> <span class=s2>&#34;Kubernetes Replication Controller Replication&#34;</span>
<span class=nx>spec</span><span class=o>:</span>
  <span class=nx>replicas</span><span class=o>:</span> <span class=mi>3</span>
  <span class=nx>selector</span><span class=o>:</span>     <span class=err>#</span><span class=nx>不能使用matchLables字符集模式</span>
    <span class=nx>controller</span><span class=o>:</span> <span class=nx>replicationcontroller</span> 
  <span class=nx>template</span><span class=o>:</span>
    <span class=nx>metadata</span><span class=o>:</span>
      <span class=nx>labels</span><span class=o>:</span>
        <span class=nx>controller</span><span class=o>:</span> <span class=nx>replicationcontroller</span>   
    <span class=nx>spec</span><span class=o>:</span>
      <span class=nx>containers</span><span class=o>:</span>
      <span class=o>-</span> <span class=nx>name</span><span class=o>:</span> <span class=nx>nginx</span><span class=o>-</span><span class=nx>rc</span><span class=o>-</span><span class=nx>demo</span> 
        <span class=nx>image</span><span class=o>:</span> <span class=nx>nginx</span><span class=o>:</span><span class=mf>1.7.9</span>
        <span class=nx>imagePullPolicy</span><span class=o>:</span> <span class=nx>IfNotPresent</span>
        <span class=nx>ports</span><span class=o>:</span>
        <span class=o>-</span> <span class=nx>name</span><span class=o>:</span> <span class=nx>http</span><span class=o>-</span><span class=mi>80</span><span class=o>-</span><span class=nx>port</span>
          <span class=nx>protocol</span><span class=o>:</span> <span class=nx>TCP</span>
          <span class=nx>containerPort</span><span class=o>:</span> <span class=mi>80</span>
</code></pre></td></tr></table></div></div><p>\2. 生成RC并查看列表</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-js data-lang=js><span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=nx>happylau</span><span class=p>]</span><span class=err>#</span> <span class=nx>kubectl</span> <span class=nx>apply</span> <span class=o>-</span><span class=nx>f</span> <span class=nx>rc</span><span class=o>-</span><span class=nx>demo</span><span class=p>.</span><span class=nx>yaml</span> 
<span class=nx>replicationcontroller</span><span class=o>/</span><span class=nx>rc</span><span class=o>-</span><span class=nx>demo</span> <span class=nx>created</span>

<span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=nx>happylau</span><span class=p>]</span><span class=err>#</span> <span class=nx>kubectl</span> <span class=nx>get</span> <span class=nx>replicationcontrollers</span> 
<span class=nx>NAME</span>      <span class=nx>DESIRED</span>   <span class=nx>CURRENT</span>   <span class=nx>READY</span>   <span class=nx>AGE</span>
<span class=nx>rc</span><span class=o>-</span><span class=nx>demo</span>   <span class=mi>3</span>         <span class=mi>3</span>         <span class=mi>3</span>       <span class=mi>103</span><span class=nx>s</span>

<span class=err>#</span><span class=nx>查看详情</span>
<span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=nx>happylau</span><span class=p>]</span><span class=err>#</span> <span class=nx>kubectl</span> <span class=nx>describe</span> <span class=nx>replicationcontrollers</span> <span class=nx>rc</span><span class=o>-</span><span class=nx>demo</span> 
<span class=nx>Name</span><span class=o>:</span>         <span class=nx>rc</span><span class=o>-</span><span class=nx>demo</span>
<span class=nx>Namespace</span><span class=o>:</span>    <span class=k>default</span>
<span class=nx>Selector</span><span class=o>:</span>     <span class=nx>controller</span><span class=o>=</span><span class=nx>replicationcontroller</span>
<span class=nx>Labels</span><span class=o>:</span>       <span class=nx>controller</span><span class=o>=</span><span class=nx>replicationcontroller</span>
<span class=nx>Annotations</span><span class=o>:</span>  <span class=nx>kubectl</span><span class=p>.</span><span class=nx>kubernetes</span><span class=p>.</span><span class=nx>io</span><span class=o>/</span><span class=nx>last</span><span class=o>-</span><span class=nx>applied</span><span class=o>-</span><span class=nx>configuration</span><span class=o>:</span>
                <span class=p>{</span><span class=s2>&#34;apiVersion&#34;</span><span class=o>:</span><span class=s2>&#34;v1&#34;</span><span class=p>,</span><span class=s2>&#34;kind&#34;</span><span class=o>:</span><span class=s2>&#34;ReplicationController&#34;</span><span class=p>,</span><span class=s2>&#34;metadata&#34;</span><span class=o>:</span><span class=p>{</span><span class=s2>&#34;annotations&#34;</span><span class=o>:</span><span class=p>{</span><span class=s2>&#34;kubernetes.io/description&#34;</span><span class=o>:</span><span class=err>&#34;</span><span class=nx>Kubernetes</span> <span class=nx>Replication</span> <span class=nx>Controlle</span><span class=p>...</span>
              <span class=nx>kubernetes</span><span class=p>.</span><span class=nx>io</span><span class=o>/</span><span class=nx>description</span><span class=o>:</span> <span class=nx>Kubernetes</span> <span class=nx>Replication</span> <span class=nx>Controller</span> <span class=nx>Replication</span>
<span class=nx>Replicas</span><span class=o>:</span>     <span class=mi>3</span> <span class=nx>current</span> <span class=o>/</span> <span class=mi>3</span> <span class=nx>desired</span>
<span class=nx>Pods</span> <span class=nx>Status</span><span class=o>:</span>  <span class=mi>3</span> <span class=nx>Running</span> <span class=o>/</span> <span class=mi>0</span> <span class=nx>Waiting</span> <span class=o>/</span> <span class=mi>0</span> <span class=nx>Succeeded</span> <span class=o>/</span> <span class=mi>0</span> <span class=nx>Failed</span>
<span class=nx>Pod</span> <span class=nx>Template</span><span class=o>:</span>
  <span class=nx>Labels</span><span class=o>:</span>  <span class=nx>controller</span><span class=o>=</span><span class=nx>replicationcontroller</span>
  <span class=nx>Containers</span><span class=o>:</span>
   <span class=nx>nginx</span><span class=o>-</span><span class=nx>rc</span><span class=o>-</span><span class=nx>demo</span><span class=o>:</span>
    <span class=nx>Image</span><span class=o>:</span>        <span class=nx>nginx</span><span class=o>:</span><span class=mf>1.7.9</span>
    <span class=nx>Port</span><span class=o>:</span>         <span class=mi>80</span><span class=o>/</span><span class=nx>TCP</span>
    <span class=nx>Host</span> <span class=nx>Port</span><span class=o>:</span>    <span class=mi>0</span><span class=o>/</span><span class=nx>TCP</span>
    <span class=nx>Environment</span><span class=o>:</span>  <span class=o>&lt;</span><span class=nx>none</span><span class=o>&gt;</span>
    <span class=nx>Mounts</span><span class=o>:</span>       <span class=o>&lt;</span><span class=nx>none</span><span class=o>&gt;</span>
  <span class=nx>Volumes</span><span class=o>:</span>        <span class=o>&lt;</span><span class=nx>none</span><span class=o>&gt;</span>
<span class=nx>Events</span><span class=o>:</span>
  <span class=nx>Type</span>    <span class=nx>Reason</span>            <span class=nx>Age</span>   <span class=nx>From</span>                    <span class=nx>Message</span>
  <span class=o>----</span>    <span class=o>------</span>            <span class=o>----</span>  <span class=o>----</span>                    <span class=o>-------</span>
  <span class=nx>Normal</span>  <span class=nx>SuccessfulCreate</span>  <span class=mi>113</span><span class=nx>s</span>  <span class=nx>replication</span><span class=o>-</span><span class=nx>controller</span>  <span class=nx>Created</span> <span class=nx>pod</span><span class=o>:</span> <span class=nx>rc</span><span class=o>-</span><span class=nx>demo</span><span class=o>-</span><span class=nx>hm8s9</span>
  <span class=nx>Normal</span>  <span class=nx>SuccessfulCreate</span>  <span class=mi>113</span><span class=nx>s</span>  <span class=nx>replication</span><span class=o>-</span><span class=nx>controller</span>  <span class=nx>Created</span> <span class=nx>pod</span><span class=o>:</span> <span class=nx>rc</span><span class=o>-</span><span class=nx>demo</span><span class=o>-</span><span class=nx>xnfht</span>
  <span class=nx>Normal</span>  <span class=nx>SuccessfulCreate</span>  <span class=mi>113</span><span class=nx>s</span>  <span class=nx>replication</span><span class=o>-</span><span class=nx>controller</span>  <span class=nx>Created</span> <span class=nx>pod</span><span class=o>:</span> <span class=nx>rc</span><span class=o>-</span><span class=nx>demo</span><span class=o>-</span><span class=nx>lfhc9</span>
</code></pre></td></tr></table></div></div><p>3.副本扩容至4个</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-js data-lang=js><span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=nx>happylau</span><span class=p>]</span><span class=err>#</span> <span class=nx>kubectl</span> <span class=nx>scale</span> <span class=o>--</span><span class=nx>replicas</span><span class=o>=</span><span class=mi>4</span> <span class=nx>replicationcontroller</span> <span class=nx>rc</span><span class=o>-</span><span class=nx>demo</span> 
<span class=nx>replicationcontroller</span><span class=o>/</span><span class=nx>rc</span><span class=o>-</span><span class=nx>demo</span> <span class=nx>scaled</span>
<span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=nx>happylau</span><span class=p>]</span><span class=err>#</span> <span class=nx>kubectl</span> <span class=nx>get</span> <span class=nx>replicationcontrollers</span> 
<span class=nx>NAME</span>      <span class=nx>DESIRED</span>   <span class=nx>CURRENT</span>   <span class=nx>READY</span>   <span class=nx>AGE</span>
<span class=nx>rc</span><span class=o>-</span><span class=nx>demo</span>   <span class=mi>4</span>         <span class=mi>4</span>         <span class=mi>4</span>       <span class=mi>3</span><span class=nx>m23s</span> 
</code></pre></td></tr></table></div></div><p>\4. 副本缩容至2个</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-js data-lang=js><span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=nx>happylau</span><span class=p>]</span><span class=err>#</span> <span class=nx>kubectl</span> <span class=nx>scale</span> <span class=o>--</span><span class=nx>replicas</span><span class=o>=</span><span class=mi>2</span> <span class=nx>replicationcontroller</span> <span class=nx>rc</span><span class=o>-</span><span class=nx>demo</span> 
<span class=nx>replicationcontroller</span><span class=o>/</span><span class=nx>rc</span><span class=o>-</span><span class=nx>demo</span> <span class=nx>scaled</span>
<span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=nx>happylau</span><span class=p>]</span><span class=err>#</span> <span class=nx>kubectl</span> <span class=nx>get</span> <span class=nx>replicationcontrollers</span> 
<span class=nx>NAME</span>      <span class=nx>DESIRED</span>   <span class=nx>CURRENT</span>   <span class=nx>READY</span>   <span class=nx>AGE</span>
<span class=nx>rc</span><span class=o>-</span><span class=nx>demo</span>   <span class=mi>2</span>         <span class=mi>2</span>         <span class=mi>2</span>       <span class=mi>3</span><span class=nx>m51s</span>
</code></pre></td></tr></table></div></div><h1 id=写在最后>写在最后</h1><p>本文介绍了kubernetes中三个副本控制器：Deployment，ReplicaSet和ReplicationController，当前使用最广泛的是Deployment，ReplicaSet为Deployment提供滚动更新机制，RC当前是旧版的副本控制器，当前已废弃，推荐使用Deployment控制器，具备副本控制器，扩展副本，缩减副本，滚动升级和回滚等高级能力。</p><h1 id=参考文献>参考文献</h1><p>Deployment：https://kubernetes.io/docs/concepts/workloads/controllers/deployment/</p><p>ReplicaSet：https://kubernetes.io/docs/concepts/workloads/controllers/replicaset/</p><p>ReplicationController：[https://kubernetes.io/docs/concepts/workloads/controllers/</p><blockquote><p>『 转载 』该文章来源于网络，侵删。</p></blockquote></div><div class=post-copyright><p class=copyright-item><span class=item-title>Author</span>
<span class=item-content><a href=https://agou-ops.cn/author/agou-ops/>AGou-ops</a></span></p><p class=copyright-item><span class=item-title>LastMod</span>
<span class=item-content>2019-08-04</span></p><p class=copyright-item><span class=item-title>License</span>
<span class=item-content><a href=http://www.wtfpl.net/about/ rel=noopener target=_blank>WTFPL v2</a></span></p></div><div class=post-reward><input type=checkbox name=reward id=reward hidden>
<label class=reward-button for=reward>Want To Reward Me?</label><div class=qr-code><label class=qr-code-image for=reward><img class=image src=https://agou-images.oss-cn-qingdao.aliyuncs.com/BaseIMG/wechat.png>
<span>Wechat</span></label>
<label class=qr-code-image for=reward><img class=image src=https://agou-images.oss-cn-qingdao.aliyuncs.com/BaseIMG/alipay.png>
<span>Alipay</span></label></div></div><footer class=post-footer><div class=post-tags><a href=https://agou-ops.cn/tags/kubernetes/>kubernetes</a></div><nav class=post-nav><a class=prev href=/post/k8s/10-%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0%E6%8C%81%E4%B9%85%E5%8C%96%E5%AD%98%E5%82%A8pv%E5%92%8Cpvc/><i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18"><path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417l277.93508-310.326815c11.338233-12.190647 11.035334-32.285311-.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"/></svg></i><span class="prev-text nav-default">10 深入学习持久化存储PV和PVC</span>
<span class="prev-text nav-mobile">Prev</span></a>
<a class=next href=/post/k8s/12-%E8%AF%A6%E8%A7%A3daemonset%E6%8E%A7%E5%88%B6%E5%99%A8/><span class="next-text nav-default">12 详解DaemonSet控制器</span>
<span class="prev-text nav-mobile">Next</span>
<i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18"><path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"/></svg></i></a></nav></footer></article><div class="post bg-white"><script src=https://utteranc.es/client.js repo=AGou-ops/comments issue-term=pathname theme=github-light crossorigin=anonymous async></script></div></div></div></main><footer id=footer class=footer><div class=icon-links><a href=mailto:agou-ops@foxmail.com rel="me noopener" class=iconfont title=email><svg class="icon" viewBox="0 0 1451 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="36" height="36"><path d="M664.781909 681.472759.0 97.881301C0 3.997201 71.046997.0 71.046997.0H474.477909 961.649408 1361.641813S1432.688811 3.997201 1432.688811 97.881301L771.345323 681.472759S764.482731 685.154773 753.594283 688.65053V688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858V688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759zM718.063616 811.603883C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633.0 212.052267.0 212.052267V942.809523L83.726336 1024H682.532949 753.579947 1348.948139L1432.688811 942.809523V212.052267S893.138176 701.759633 817.019477 767.734955C777.248 802.205449 742.347691 811.03081 718.063616 811.603883z"/></svg></a><a href=https://space.bilibili.com/283008785 rel="me noopener" class=iconfont title=bilibili target=_blank><svg class="icon" viewBox="0 0 1024 1024" width="36" height="36" id="svg8"><path d="M744.60599.00486267A41.779915 41.779915.0 00710.4184 18.673394L548.5048 255.32642h-11.70046a41.779915 41.779915.0 00-10.80295-7.84928L235.66 97.084498a41.779915 41.779915.0 00-20.07193-4.960864 41.779915 41.779915.0 00-18.3748 79.145436L359.4859 255.32642H128.16909c-49.458302.0-89.27932 39.82105-89.27932 89.27932v508.65224c0 49.4583 39.821018 89.27934 89.27932 89.27934h19.48445C149.12802 984.5043 179.92773 1024 224.79179 1024c44.86407.0 75.66379-39.4957 77.13826-81.46268H719.98116C721.45559 984.5043 752.25533 1024 797.1194 1024c44.86406.0 75.6638-39.4957 77.13824-81.46268h21.57323c49.45831.0 89.27936-39.82104 89.27936-89.27934V344.60574c0-49.45827-39.82105-89.27932-89.27936-89.27932H649.74567L779.38103 65.866924A41.779915 41.779915.0 00744.60599.00486267zM644.49108 418.70871c6.29985.21538 12.44451 2.01107 17.86888 5.22196l171.36218 98.10771c18.23417 10.21935 24.63334 33.34627 14.24614 51.48533-10.38726 18.13909-33.57344 24.32718-51.61587 13.77296L624.9903 489.18895c-15.21356-8.41858-22.66871-26.1765-18.03211-42.93436 4.63664-16.75784 20.15573-28.14465 37.53289-27.54588zM350.2006 432.31846c16.89952.0317 31.69582 11.33328 36.17844 27.62747 4.48262 16.2942-2.44981 33.57765-16.95507 42.24898l-140.7157 86.91312c-17.68528 11.18244-41.09629 5.77692-52.08912-12.02686-10.99282-17.80373-5.33855-41.15658 12.58167-51.95857L329.9002 438.2095c6.0643-3.86439 13.10951-5.90891 20.3004-5.89104zM501.605 641.53985c3.75002-.15248 7.48645.53903 10.93349 2.0235.15842.0637.31618.12888.47325.19582.59328.27092 1.17574.56489 1.74609.88121.15868.0854.31643.17233.47325.2611.55694.32165 1.10131.66458 1.63185 1.02807.16455.1123.32777.2265.48956.34269.50382.36781.99371.75428 1.46868 1.15864.18724.15504.37218.31282.55484.47323.43271.38784.8518.79061 1.25653 1.20756.15449.16114.30679.32437.45693.48959.40798.44266.79989.89988 1.17494 1.37076.17799.22544.35205.45395.5222.68538.25932.34701.50964.70071.75064 1.06071.26712.39516.52286.79784.76699 1.20757.16907.29043.33231.58424.48957.88123.21836.41297.42513.83199.62009 1.25653.14836.32333.28983.64976.42429.97911.21319.51552.40915 1.03801.58747 1.5666.0677.19499.13296.39085.19582.58748.18652.60823.34984 1.22334.48957 1.84399.0397.16277.0779.32601.11423.48957.1436.69112.25788 1.38801.34269 2.08877.005.0381.0111.0761.0163.11424.0857.78056.13474 1.56471.14687 2.34988.005.0543.0111.10879.0163.1632.0.0-.008 1.12132.0 1.45234.0.0-.14697 17.84761 5.89102 34.12231 3.01902 8.13734 7.33278 15.10615 12.61433 19.61501 5.28157 4.50889 11.42894 7.62081 23.64572 7.62081 12.2168.0 18.36416-3.11192 23.64573-7.62081 5.28154-4.50886 9.5953-11.47767 12.6143-19.61501 6.03799-16.2747 5.89103-34.12231 5.89103-34.12231-.44885-13.87045 10.45922-25.46302 24.3311-25.86506 13.87189-.40201 25.42828 10.53953 25.78348 24.41272.0.0 1.11929 25.7226-9.00791 53.01927-5.06359 13.64832-13.1986 28.46036-27.05631 40.29073-13.85772 11.83039-33.5454 19.63135-56.20142 19.63135-22.65603.0-42.34371-7.80096-56.20141-19.63135-4.1801-3.56856-7.78733-7.42433-10.99878-11.42303-3.21235 4.00037-6.81703 7.85309-10.99876 11.42303-13.85773 11.83039-33.5454 19.63135-56.20144 19.63135-22.65601.0-42.3437-7.80096-56.2014-19.63135-13.85775-11.83037-21.99272-26.64241-27.05632-40.29073-10.12725-27.29667-9.00789-53.01928-9.00789-53.01927.20714-13.83687 11.58744-24.88848 25.42444-24.69013 14.1263.19991 25.2971 12.0278 24.69011 26.14247.0.0-.14697 17.84761 5.89103 34.12231 3.01902 8.13734 7.31646 15.10615 12.598 19.61501 5.28155 4.50889 11.44526 7.62081 23.66203 7.62081 12.21681.0 18.36418-3.11192 23.64573-7.62081 5.28154-4.50886 9.57899-11.47767 12.598-19.61501 5.76352-15.53489 5.89112-32.05691 5.89103-33.56746.006-.37466.0111-1.05336.0163-1.20759-.0117-.74583.0105-1.49177.0652-2.23565.009-.15784.0204-.31561.0327-.47324.14204-1.56859.43163-3.12027.86487-4.63449.0213-.0763.0433-.15244.0652-.22848 3.0335-10.25748 12.24157-17.46007 22.92769-17.93417z" id="rect824"/></svg></a><a href=https://www.youtube.com/channel/UCkLgMBY9hnLegjLTulM1guw rel="me noopener" class=iconfont title=youtube target=_blank><svg fill="#000" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="36" height="36"><path fill-rule="evenodd" d="M13 5l3 9v6h2V14l3-9H19l-2 6-2-6zM24 9C22.933594 9 22.410156 9.167969 21.757813 9.703125 21.132813 10.230469 20.960938 10.636719 21 12v5C21 17.996094 21.164063 18.652344 21.765625 19.234375 22.390625 19.816406 22.980469 20 24 20 25.066406 20 25.648438 19.816406 26.25 19.234375 26.875 18.675781 27 17.996094 27 17V12C27 11.117188 26.84375 10.28125 26.238281 9.722656 25.613281 9.148438 24.96875 9 24 9zm5 0v9C29 18.972656 29.980469 20 31 20S32.558594 19.488281 33 19v1h2V9H33v8C32.988281 17.683594 32.183594 18 32 18 31.792969 18 31 17.957031 31 17V9zm-5 2C24.300781 11 25 10.996094 25 12v5C25 17.96875 24.324219 18 24 18 23.699219 18 23 17.988281 23 17V12C23 11.183594 23.433594 11 24 11zM10 22C6.40625 22 4 24.382813 4 28v9.5C4 41.117188 6.40625 44 10 44H40C43.59375 44 46 41.617188 46 38V28C46 24.382813 43.59375 22 40 22zm2 4h6v2H16V40H14V28H12zm14 0h2v4C28.230469 29.640625 28.574219 29.355469 28.902344 29.195313 29.222656 29.03125 29.546875 28.9375 29.875 28.9375 30.523438 28.9375 31.03125 29.171875 31.378906 29.609375 31.726563 30.050781 32 30.636719 32 31.5v6C32 38.242188 31.75 38.703125 31.421875 39.097656 31.101563 39.492188 30.621094 39.992188 30 40 28.949219 40.011719 28.386719 39.449219 28 39v1H26zm-8 3h2v8C20 37.230469 20.269531 38.007813 21 38 21.8125 37.992188 21.820313 37.234375 22 37V29h2V40H22V39C21.628906 39.4375 21.4375 39.574219 21.019531 39.78125 20.605469 40.015625 20.183594 40 19.792969 40 19.308594 40 18.757813 39.5625 18.5 39.234375 18.269531 38.933594 18 38.625 18 38zm18.199219.0C37.148438 29 37.816406 29.203125 38.320313 29.734375 38.835938 30.265625 39 30.886719 39 31.886719V35H35v1.546875C35 37.105469 35.074219 37.460938 35.21875 37.671875 35.355469 37.902344 35.632813 38.003906 36 38 36.40625 37.996094 36.664063 37.914063 36.800781 37.730469 36.941406 37.566406 37 37.101563 37 36.5V36h2v.59375C39 37.683594 38.914063 38.496094 38.375 39.027344 37.867188 39.585938 37.074219 39.84375 36.035156 39.84375 35.085938 39.84375 34.34375 39.5625 33.8125 38.984375S33.003906 37.613281 33.003906 36.59375V31.886719C33.003906 30.980469 33.320313 30.308594 33.902344 29.710938 34.371094 29.230469 35.25 29 36.199219 29zM29 30.5C28.449219 30.5 28.007813 30.996094 28 31.5v6C28.007813 37.789063 28.449219 38 29 38S30 37.574219 30 37.023438V32C30 31 29.550781 30.5 29 30.5zm7 .5C35.449219 31 35.007813 31.464844 35 32v1h2V32C37 31.386719 36.550781 31 36 31z"/></svg></a><a href=https://twitter.com/AgouOps rel="me noopener" class=iconfont title=twitter target=_blank><svg class="icon" viewBox="0 0 1264 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="36" height="36"><path d="M1229.8616 18.043658s-117.852626 63.135335-164.151872 67.344358c-105.225559-164.151872-505.082682-92.598492-437.738325 223.078185C278.622548 312.675223 89.216542 47.506814 89.216542 47.506814s-117.852626 189.406006 75.762402 345.139833C127.097743 396.85567 55.544363 371.601535 55.544363 371.601535S26.081207 535.753407 253.368414 615.724832c-21.045112 29.463156-113.643603 8.418045-113.643603 8.418045s25.254134 143.10676 231.496229 180.987961c-143.10676 130.479693-387.230056 92.598492-370.393967 105.225559 206.242095 189.406006 1119.599946 231.496229 1128.01799-643.98042C1179.353331 249.539887 1263.533778 123.269217 1263.533778 123.269217s-130.479693 37.881201-138.897738 33.672179C1225.652577 98.015083 1229.8616 18.043658 1229.8616 18.043658"/></svg></a><a href=https://github.com/AGou-ops rel="me noopener" class=iconfont title=github target=_blank><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="36" height="36"><path d="M512 12.672c-282.88.0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667.0-12.16-.426667-44.373333-.64-87.04-142.421333 30.890667-172.458667-68.693333-172.458667-68.693333C188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333.0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333.0.0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667.0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72.0 68.522667-.64 123.562667-.64 140.202666.0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"/></svg></a><a href=https://agou-ops.cn/index.xml rel="noopener alternate" type=application/rss+xml class=iconfont title=rss target=_blank><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="30" height="30"><path d="M819.157333 1024C819.157333 574.592 449.408 204.8.0 204.8V0c561.706667.0 1024 462.293333 1024 1024H819.157333zM140.416 743.04a140.8 140.8.0 01140.501333 140.586667A140.928 140.928.0 01140.074667 1024C62.72 1024 0 961.109333.0 883.626667S62.933333 743.082667 140.416 743.04zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667V345.173333c372.352.0 678.784 306.517333 678.784 678.826667z"/></svg></a></div><div class=copyright><span class=copyright-year>&copy;
2018 -
2021
<span class=heart><i class=iconfont><svg class="icon" viewBox="0 0 1025 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="14" height="14"><path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7.0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1.0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2.0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3.1-42.5-8-83.6-24-122.2z" fill="#8a8a8a"/></svg></i></span><span class=author>AGou-ops</span></span>
<span class=power-by><a title="Host on GitHub & AliOSS"><img alt="Ecologi (Carbon Offset)" src=https://img.shields.io/badge/Host%20on-GitHub%20%26%20AliOSS-blue></a></span>
<span class=theme-info><a title="Provided by Algolia & utteranc"><img alt="Ecologi (Carbon Offset)" src=https://img.shields.io/badge/Providers-Algolia%20%26%20utteranc-brightgreen></a></span></br><span id=busuanzi_container style=font-size:15px>访客数/访问量：<span id=busuanzi_value_site_uv></span>/<span id=busuanzi_value_site_pv></span></span>
<span><a class=theme-link href=https://beian.miit.gov.cn style=font-size:15px>鲁ICP备19050296号-2</a></span></div></footer><div class=back-to-top id=back-to-top><i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="35" height="35"><path d="M510.866688 227.694839 95.449397 629.218702h235.761562L329.15309 958.01517h362.40389L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777h894.052392v131.813095H63.840492V63.962777zm0 0"/></svg></i></div></div><script type=text/javascript src=https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js crossorigin=anonymous></script><script type=text/javascript src=https://cdn.bootcss.com/slideout/1.0.1/slideout.min.js crossorigin=anonymous></script><script type=text/javascript src=/js/main.5807252ad094527cad5c7951a7789078ffbe07989e278d5d65298bfbaa35c615.js integrity crossorigin=anonymous></script><script id=baidu_push>(function(){if(window.location.hostname==='localhost')return;var bp=document.createElement('script');bp.async=true;var curProtocol=window.location.protocol.split(':')[0];if(curProtocol==='https'){bp.src='https://zz.bdstatic.com/linksubmit/push.js';}else{bp.src='http://push.zhanzhang.baidu.com/push.js';}
var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(bp,s);})();</script><script src=/js/load-photoswipe.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/photoswipe.min.js integrity="sha256-UplRCs9v4KXVJvVY+p+RSo5Q4ilAUXh7kpjyIP5odyc=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/photoswipe-ui-default.min.js integrity="sha256-PWHOlUzc96pMc8ThwRIXPn8yH4NOLu42RQ0b9SpnpFk=" crossorigin=anonymous></script><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><script src=https://cdn.jsdelivr.net/npm/docsearch.js@2.6.3/dist/cdn/docsearch.min.js></script><script>docsearch({apiKey:"6a2c773473e3d77a8e761f3f64825c5a",indexName:"main-blog",appId:"5M8VQRD7W9",inputSelector:'.docsearch-input',debug:false,});</script><script src=https://cdn.jsdelivr.net/npm/docsearch.js@2.6.3/dist/cdn/docsearch.min.js></script><script>docsearch({apiKey:"6a2c773473e3d77a8e761f3f64825c5a",indexName:"main-blog",appId:"5M8VQRD7W9",inputSelector:'.docsearch',debug:false,});</script><script src=/js/layer.js></script></body></html>