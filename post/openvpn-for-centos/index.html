<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>OpenVPN for CentOS - AGou's blog</title><meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=MobileOptimized content="width"><meta name=HandheldFriendly content="true"><meta name=applicable-device content="pc,mobile"><meta name=theme-color content="#f8f5ec"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><meta name=mobile-web-app-capable content="yes"><meta name=author content="AGou-ops"><meta name=description content="OpenVPN 简介 OpenVPN 是一个基于 OpenSSL 库的应用层 VPN 实现。和传统 VPN 相比，它的优点是简单易用。 [1]
OpenVPN允许参与建立VPN的单点使用共享金钥，电子证书，或者用户名/密码来进行身份验证。它大量使用了OpenSSL加密库中的SSLv3/TLSv1 协议函式库。OpenVPN能在Solaris、Linux、OpenBSD、FreeBSD、NetBSD、Mac OS X与Windows 2000/XP/Vista上运行，并包含了许多安全性的功能。它并不是一个基于Web的VPN软件，也不与IPsec及其他VPN软件包兼容。"><meta name=keywords content="AGou,blog,阿狗,阿狗博客,阿狗的博客,AGou blog"><meta name=generator content="Hugo 0.69.0"><link rel=canonical href=https://agou-ops.top/post/openvpn-for-centos/><link rel=icon type=image/x-ico href=https://s1.ax1x.com/2020/05/19/Y4cixe.png><link rel=stylesheet href=/sass/jane.min.ae84bffddff526c5933b08eed670eadf3786a3bf560c1ef6f4000987a74049f8.css integrity="sha256-roS//d/1JsWTOwju1nDq3zeGo79WDB729AAJh6dASfg=" media=screen crossorigin=anonymous><meta property="og:title" content="OpenVPN for CentOS"><meta property="og:description" content="OpenVPN 简介
OpenVPN 是一个基于 OpenSSL 库的应用层 VPN 实现。和传统 VPN 相比，它的优点是简单易用。 [1]
OpenVPN允许参与建立VPN的单点使用共享金钥，电子证书，或者用户名/密码来进行身份验证。它大量使用了OpenSSL加密库中的SSLv3/TLSv1 协议函式库。OpenVPN能在Solaris、Linux、OpenBSD、FreeBSD、NetBSD、Mac OS X与Windows 2000/XP/Vista上运行，并包含了许多安全性的功能。它并不是一个基于Web的VPN软件，也不与IPsec及其他VPN软件包兼容。"><meta property="og:type" content="article"><meta property="og:url" content="https://agou-ops.top/post/openvpn-for-centos/"><meta property="article:published_time" content="2020-05-21T19:42:06+08:00"><meta property="article:modified_time" content="2020-05-21T19:42:06+08:00"><meta itemprop=name content="OpenVPN for CentOS"><meta itemprop=description content="OpenVPN 简介
OpenVPN 是一个基于 OpenSSL 库的应用层 VPN 实现。和传统 VPN 相比，它的优点是简单易用。 [1]
OpenVPN允许参与建立VPN的单点使用共享金钥，电子证书，或者用户名/密码来进行身份验证。它大量使用了OpenSSL加密库中的SSLv3/TLSv1 协议函式库。OpenVPN能在Solaris、Linux、OpenBSD、FreeBSD、NetBSD、Mac OS X与Windows 2000/XP/Vista上运行，并包含了许多安全性的功能。它并不是一个基于Web的VPN软件，也不与IPsec及其他VPN软件包兼容。"><meta itemprop=datePublished content="2020-05-21T19:42:06+08:00"><meta itemprop=dateModified content="2020-05-21T19:42:06+08:00"><meta itemprop=wordCount content="3308"><meta itemprop=keywords content="OpenVPN,CentOS,"><meta name=twitter:card content="summary"><meta name=twitter:title content="OpenVPN for CentOS"><meta name=twitter:description content="OpenVPN 简介
OpenVPN 是一个基于 OpenSSL 库的应用层 VPN 实现。和传统 VPN 相比，它的优点是简单易用。 [1]
OpenVPN允许参与建立VPN的单点使用共享金钥，电子证书，或者用户名/密码来进行身份验证。它大量使用了OpenSSL加密库中的SSLv3/TLSv1 协议函式库。OpenVPN能在Solaris、Linux、OpenBSD、FreeBSD、NetBSD、Mac OS X与Windows 2000/XP/Vista上运行，并包含了许多安全性的功能。它并不是一个基于Web的VPN软件，也不与IPsec及其他VPN软件包兼容。"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script><script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=/ class=logo>AGou's blog</a></div><div class=mobile-navbar-icon><span></span><span></span><span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><li class=mobile-menu-item><a class=menu-item-link href=https://agou-ops.top/>主页</a></li><li class=mobile-menu-item><a class=menu-item-link href=https://agou-ops.top/post/>归档</a></li><li class=mobile-menu-item><a class=menu-item-link href=https://agou-ops.top/tags/>标签</a></li><li class=mobile-menu-item><a class=menu-item-link href=https://agou-ops.top/categories/>分类</a></li><li class=mobile-menu-item><a class=menu-item-link href=https://agou-ops.top/aboutme/>关于博主</a></li><li class=mobile-menu-item><a class=menu-item-link href=https://agou-ops.top/beforeWork rel=noopener target=_blank>myDocs
<i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18"><path d="M623.36 272.96 473.216 423.04C467.2 429.056 467.072 438.656 472.896 444.416c0 0-6.72-6.656 1.6 1.6C496.064 467.648 528.64 500.224 528.64 500.224 534.464 506.048 544 505.856 550.016 499.904l150.08-150.144 67.328 66.432c9.024 8.96 27.456 4.544 30.4-8.96 19.968-92.608 46.656-227.52 46.656-227.52 6.848-34.496-16.192-56.704-49.92-49.92.0.0-134.656 26.816-227.328 46.784C560.32 178.048 556.352 182.272 554.752 187.136c-3.2 6.208-3.008 14.208 3.776 20.992L623.36 272.96z"/><path d="M841.152 457.152c-30.528.0-54.784 24.512-54.784 54.656V786.56H237.696V237.696h206.016c6.656.0 10.752.0 13.248.0C487.68 237.696 512 213.184 512 182.848 512 152.32 487.36 128 456.96 128H183.04C153.216 128 128 152.576 128 182.848c0 3.136.256 6.272.768 9.28C128.256 195.136 128 198.272 128 201.408v639.488c0 .064.0.192.0.256.0.128.0.192.0.32.0 30.528 24.512 54.784 54.784 54.784H829.76c6.592.0 9.728.0 11.712.0 28.736.0 52.928-22.976 54.464-51.968C896 843.264 896 842.304 896 841.344v-20.352V561.408 512.128C896 481.792 871.424 457.152 841.152 457.152z"/></svg></i></a></li><li class=mobile-menu-item><a class=menu-item-link href=https://agou-ops.top/myStudyNote/ rel=noopener target=_blank>myStudyNote
<i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18"><path d="M623.36 272.96 473.216 423.04C467.2 429.056 467.072 438.656 472.896 444.416c0 0-6.72-6.656 1.6 1.6C496.064 467.648 528.64 500.224 528.64 500.224 534.464 506.048 544 505.856 550.016 499.904l150.08-150.144 67.328 66.432c9.024 8.96 27.456 4.544 30.4-8.96 19.968-92.608 46.656-227.52 46.656-227.52 6.848-34.496-16.192-56.704-49.92-49.92.0.0-134.656 26.816-227.328 46.784C560.32 178.048 556.352 182.272 554.752 187.136c-3.2 6.208-3.008 14.208 3.776 20.992L623.36 272.96z"/><path d="M841.152 457.152c-30.528.0-54.784 24.512-54.784 54.656V786.56H237.696V237.696h206.016c6.656.0 10.752.0 13.248.0C487.68 237.696 512 213.184 512 182.848 512 152.32 487.36 128 456.96 128H183.04C153.216 128 128 152.576 128 182.848c0 3.136.256 6.272.768 9.28C128.256 195.136 128 198.272 128 201.408v639.488c0 .064.0.192.0.256.0.128.0.192.0.32.0 30.528 24.512 54.784 54.784 54.784H829.76c6.592.0 9.728.0 11.712.0 28.736.0 52.928-22.976 54.464-51.968C896 843.264 896 842.304 896 841.344v-20.352V561.408 512.128C896 481.792 871.424 457.152 841.152 457.152z"/></svg></i></a></li><li class=mobile-menu-item><div class=mobile-menu-parent><span class=mobile-submenu-open></span><a href=https://agou-ops.top/>docs</a></div><ul class=mobile-submenu-list><li><a href=https://agou-ops.top/post/shortcodes-preview/>Shortcodes Preview</a></li><li><a href=https://agou-ops.top/post/image-preview/>Image Preview</a></li></ul></li></ul></nav><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.3/photoswipe.min.css integrity="sha256-LWdHSKWG7zv3DTpee8YAgoTfkj3gNkfauF624h4P2Nw=" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.3/default-skin/default-skin.min.css integrity="sha256-Q9bBMw/rHRRag46GDWY84J3elDNc8JJjKXL9tIC4oe8=" crossorigin=anonymous><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><header id=header class="header container"><div class=logo-wrapper><a href=/ class=logo>AGou's blog</a></div><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=https://agou-ops.top/>主页</a></li><li class=menu-item><a class=menu-item-link href=https://agou-ops.top/post/>归档</a></li><li class=menu-item><a class=menu-item-link href=https://agou-ops.top/tags/>标签</a></li><li class=menu-item><a class=menu-item-link href=https://agou-ops.top/categories/>分类</a></li><li class=menu-item><a class=menu-item-link href=https://agou-ops.top/aboutme/>关于博主</a></li><li class=menu-item><a class=menu-item-link href=https://agou-ops.top/beforeWork rel=noopener target=_blank>myDocs
<i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18"><path d="M623.36 272.96 473.216 423.04C467.2 429.056 467.072 438.656 472.896 444.416c0 0-6.72-6.656 1.6 1.6C496.064 467.648 528.64 500.224 528.64 500.224 534.464 506.048 544 505.856 550.016 499.904l150.08-150.144 67.328 66.432c9.024 8.96 27.456 4.544 30.4-8.96 19.968-92.608 46.656-227.52 46.656-227.52 6.848-34.496-16.192-56.704-49.92-49.92.0.0-134.656 26.816-227.328 46.784C560.32 178.048 556.352 182.272 554.752 187.136c-3.2 6.208-3.008 14.208 3.776 20.992L623.36 272.96z"/><path d="M841.152 457.152c-30.528.0-54.784 24.512-54.784 54.656V786.56H237.696V237.696h206.016c6.656.0 10.752.0 13.248.0C487.68 237.696 512 213.184 512 182.848 512 152.32 487.36 128 456.96 128H183.04C153.216 128 128 152.576 128 182.848c0 3.136.256 6.272.768 9.28C128.256 195.136 128 198.272 128 201.408v639.488c0 .064.0.192.0.256.0.128.0.192.0.32.0 30.528 24.512 54.784 54.784 54.784H829.76c6.592.0 9.728.0 11.712.0 28.736.0 52.928-22.976 54.464-51.968C896 843.264 896 842.304 896 841.344v-20.352V561.408 512.128C896 481.792 871.424 457.152 841.152 457.152z"/></svg></i></a></li><li class=menu-item><a class=menu-item-link href=https://agou-ops.top/myStudyNote/ rel=noopener target=_blank>myStudyNote
<i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18"><path d="M623.36 272.96 473.216 423.04C467.2 429.056 467.072 438.656 472.896 444.416c0 0-6.72-6.656 1.6 1.6C496.064 467.648 528.64 500.224 528.64 500.224 534.464 506.048 544 505.856 550.016 499.904l150.08-150.144 67.328 66.432c9.024 8.96 27.456 4.544 30.4-8.96 19.968-92.608 46.656-227.52 46.656-227.52 6.848-34.496-16.192-56.704-49.92-49.92.0.0-134.656 26.816-227.328 46.784C560.32 178.048 556.352 182.272 554.752 187.136c-3.2 6.208-3.008 14.208 3.776 20.992L623.36 272.96z"/><path d="M841.152 457.152c-30.528.0-54.784 24.512-54.784 54.656V786.56H237.696V237.696h206.016c6.656.0 10.752.0 13.248.0C487.68 237.696 512 213.184 512 182.848 512 152.32 487.36 128 456.96 128H183.04C153.216 128 128 152.576 128 182.848c0 3.136.256 6.272.768 9.28C128.256 195.136 128 198.272 128 201.408v639.488c0 .064.0.192.0.256.0.128.0.192.0.32.0 30.528 24.512 54.784 54.784 54.784H829.76c6.592.0 9.728.0 11.712.0 28.736.0 52.928-22.976 54.464-51.968C896 843.264 896 842.304 896 841.344v-20.352V561.408 512.128C896 481.792 871.424 457.152 841.152 457.152z"/></svg></i></a></li><li class=menu-item><a class="menu-item-link menu-parent" href=https://agou-ops.top/>docs</a><ul class=submenu><li><a href=https://agou-ops.top/post/shortcodes-preview/>Shortcodes Preview</a></li><li><a href=https://agou-ops.top/post/image-preview/>Image Preview</a></li></ul></li></ul></nav></header><div id=mobile-panel><main id=main class="main bg-llight"><div class=content-wrapper><div id=content class="content container"><article class="post bg-white"><header class=post-header><h1 class=post-title>OpenVPN for CentOS</h1><div class=post-meta><time datetime=2020-05-21 class=post-time>2020-05-21</time><div class=post-category><a href=https://agou-ops.top/categories/vpn/>VPN</a>
<a href=https://agou-ops.top/categories/centos/>CentOS</a></div><span class=more-meta>3308 words</span>
<span class=more-meta>7 min read</span>
<span id=busuanzi_container_page_pv>| 阅读 <span id=busuanzi_value_page_pv></span></span></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title>Table of Contents</h2><div class=post-toc-content><nav id=TableOfContents><ul><li><a href=#openvpn-简介>OpenVPN 简介</a></li><li><a href=#openvpn-安装>OpenVPN 安装</a><ul><li><a href=#使用easyrsa构建-ca>使用<code>EasyRSA</code>构建 CA</a></li><li><a href=#安装-openvpn-和-easyrsa>安装 OpenVPN 和 EasyRSA</a></li><li><a href=#创建diffie-hellman和hmac密钥>创建<code>Diffie-Hellman</code>和<code>HMAC</code>密钥</a></li><li><a href=#创建服务器证书和私钥>创建服务器证书和私钥</a></li><li><a href=#配置openvpn服务>配置<code>OpenVPN</code>服务</a></li><li><a href=#启动-openvpn-服务>启动 OpenVPN 服务</a></li></ul></li><li><a href=#配置客户端接口>配置客户端接口</a></li><li><a href=#创建客户端证书私钥和配置>创建客户端证书私钥和配置</a></li><li><a href=#使用-openvpn>使用 OpenVPN</a></li><li><a href=#快速安装-openvpn>快速安装 OpenVPN</a></li></ul></nav></div></div><div class=post-content><h2 id=openvpn-简介>OpenVPN 简介</h2><p>OpenVPN 是一个基于 OpenSSL 库的应用层 VPN 实现。和传统 VPN 相比，它的优点是简单易用。 [1]</p><p>OpenVPN允许参与建立VPN的单点使用共享金钥，电子证书，或者用户名/密码来进行身份验证。它大量使用了OpenSSL加密库中的SSLv3/TLSv1 协议函式库。OpenVPN能在Solaris、Linux、OpenBSD、FreeBSD、NetBSD、Mac OS X与Windows 2000/XP/Vista上运行，并包含了许多安全性的功能。它并不是一个基于Web的VPN软件，也不与IPsec及其他VPN软件包兼容。</p><h2 id=openvpn-安装>OpenVPN 安装</h2><h3 id=使用easyrsa构建-ca>使用<code>EasyRSA</code>构建 CA</h3><ol><li>首先从项目<a href=https://github.com/OpenVPN/easy-rsa>Github存储库</a>下载EasyRSA的最新版本并解压：</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash><span class=nb>cd</span> <span class=o>&amp;&amp;</span> wget https://github.com/OpenVPN/easy-rsa/releases/download/v3.0.5/EasyRSA-nix-3.0.7.tgz
tar xzf EasyRSA-3.0.7.tgz
</code></pre></td></tr></table></div></div><ol start=2><li>复制模板文件，并进行适当修改：</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>mv EasyRSA-3.0.7 EasyRSA-CA<span class=p>;</span> <span class=nb>cd</span> EasyRSA-CA
cp vars.example vars
<span class=c1># ---------- 编辑 vars 文件内容`95`行左右 ----------</span>
set_var EASYRSA_REQ_COUNTRY    <span class=s2>&#34;CN&#34;</span>
set_var EASYRSA_REQ_PROVINCE   <span class=s2>&#34;Shandong&#34;</span>
set_var EASYRSA_REQ_CITY       <span class=s2>&#34;Jinan&#34;</span>
set_var EASYRSA_REQ_ORG        <span class=s2>&#34;AGou&#34;</span>
set_var EASYRSA_REQ_EMAIL      <span class=s2>&#34;AGou-ops@foxmail.com&#34;</span>
set_var EASYRSA_REQ_OU         <span class=s2>&#34;Community&#34;</span>
</code></pre></td></tr></table></div></div><p>修改完成之后保存退出。</p><ol start=3><li>初始化<code>PKI</code>：</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash><span class=o>[</span>root@test EasyRSA-CA<span class=o>]</span><span class=se>\#</span> ./easyrsa init-pki

Note: using Easy-RSA configuration from: /root/EasyRSA-3.0.7/vars

init-pki complete<span class=p>;</span> you may now create a CA or requests.
Your newly created PKI dir is: /root/EasyRSA-3.0.7/pki
</code></pre></td></tr></table></div></div><ol start=4><li>接下来建立<code>CA</code>：</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash><span class=o>[</span>root@test EasyRSA-CA<span class=o>]</span><span class=se>\#</span> ./easyrsa build-ca nopass

Note: using Easy-RSA configuration from: /root/EasyRSA-3.0.7/vars
Using SSL: openssl OpenSSL 1.0.2k-fips  <span class=m>26</span> Jan <span class=m>2017</span>
Generating RSA private key, <span class=m>2048</span> bit long modulus
...............+++
............................................................................................................................+++
e is <span class=m>65537</span> <span class=o>(</span>0x10001<span class=o>)</span>
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter <span class=s1>&#39;.&#39;</span>, the field will be left blank.
-----
Common Name <span class=o>(</span>eg: your user, host, or server name<span class=o>)</span> <span class=o>[</span>Easy-RSA CA<span class=o>]</span>:

CA creation <span class=nb>complete</span> and you may now import and sign cert requests.
Your new CA certificate file <span class=k>for</span> publishing is at:
/root/EasyRSA-3.0.7/pki/ca.crt
</code></pre></td></tr></table></div></div><p>完成后，该脚本将创建两个文件-CA公共证书<code>PKI/ca.crt</code>和CA私钥<code>PKI/private/ca.key</code></p><h3 id=安装-openvpn-和-easyrsa>安装 OpenVPN 和 EasyRSA</h3><ol><li>可以在 OpenVPN 的官方 github 仓库 下载最新源码包进行编译安装，在这里为了方便，我使用<code>epel</code>仓库进行安装：</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>yum install epel-release -y
yum install openvpn -y
</code></pre></td></tr></table></div></div><ol start=2><li>获取最新版本的<code>EasyRSA</code>：</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash><span class=nb>cd</span> <span class=o>&amp;&amp;</span> wget https://github.com/OpenVPN/easy-rsa/releases/download/v3.0.5/EasyRSA-nix-3.0.7.tgz
tar xzf EasyRSA-3.0.7.tgz
mv EasyRSA-3.0.7 EasyRSA-Sever1
<span class=nb>cd</span> EasyRSA-Sever1
</code></pre></td></tr></table></div></div><ol start=3><li>尽管我们已经在 CA 主机上初始化了PKI，但是我们还需要在 <code>OpenVPN 服务器</code>上创建一个新的 PKI ：</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash><span class=o>[</span>root@test EasyRSA-Server1<span class=o>]</span><span class=se>\#</span> ./easyrsa init-pki

Note: using Easy-RSA configuration from: /root/EasyRSA-Server1/vars

init-pki complete<span class=p>;</span> you may now create a CA or requests.
Your newly created PKI dir is: /root/EasyRSA-Server1/pki
</code></pre></td></tr></table></div></div><h3 id=创建diffie-hellman和hmac密钥>创建<code>Diffie-Hellman</code>和<code>HMAC</code>密钥</h3><p>生成一个<code>Diffie-Hellman</code>密钥，该密钥将在密钥交换期间使用，并使用<code>HMAC</code>签名文件为连接添加附加的安全层。</p><ol><li>在<code>OpenVPN</code>服务器上，生成<code>Diffie-Hellman</code>密钥：</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash><span class=nb>cd</span> ~/EasyRSA-Server1
./easyrsa gen-dh
</code></pre></td></tr></table></div></div><ol start=2><li>复制该文件到<code>/etc/openvpn</code>目录中去：</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>cp /root/EasyRSA-Server1/pki/dh.pem /etc/openvpn
</code></pre></td></tr></table></div></div><ol start=3><li>接下来，使用<code>openvpn</code>二进制文件生成<code>HMAC</code>签名：</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>openvpn --genkey --secret ta.key
</code></pre></td></tr></table></div></div><p>然后将生成的<code>ta.key</code>复制到<code>/etc/openvpn</code>目录中去：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>cp ta.key /etc/openvpn
</code></pre></td></tr></table></div></div><h3 id=创建服务器证书和私钥>创建服务器证书和私钥</h3><ol><li>进入<code>OpenVPN服务器</code>上的EasyRSA目录，并为服务器和证书请求文件生成一个新的私钥：</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash><span class=nb>cd</span> ~/EasyRSA-Server1
./easyrsa gen-req server1 nopass
</code></pre></td></tr></table></div></div><p>该命令将创建两个文件，一个私钥（<code>server1.key</code>）和一个证书请求文件（<code>server1.req</code>）</p><ol start=2><li>将生成的私钥复制到<code>/etc/openvpn</code>目录：</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>cp /root/EasyRSA-Server1/pki/private/server1.key /etc/openvpn/
</code></pre></td></tr></table></div></div><ol start=3><li>将证书请求发送到<code>CA</code>主机（这里我CA主机与OpenVPN为同一主机）：</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>cp ~/EasyRSA-Server1/pki/reqs/server1.req /tmp
</code></pre></td></tr></table></div></div><ol start=4><li>登录<code>CA主机</code>，切换到 EasyRSA 目录并导入证书请求文件：</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash><span class=nb>cd</span> ~/EasyRSA-CA
./easyrsa import-req /tmp/server1.req server1
</code></pre></td></tr></table></div></div><p>此命令只是将请求文件复制到<code>pki/reqs</code>目录中。</p><ol start=5><li>在<code>CA主机</code>上，签署证书：</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>./easyrsa sign-req server server1
</code></pre></td></tr></table></div></div><p>确认信息无误之后，输入 yes 然后点击回车即可。</p><ol start=6><li>在<code>CA主机</code>上，将签名的证书<code>server1.crt</code>和<code>ca.crt</code>文件传发送回<code>OpenVPN主机</code>：</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>cp ~/EasyRSA-CA/pki/issued/server1.crt /etc/openvpn/
cp ~/EasyRSA-CA/pki/ca.crt /etc/openvpn/
</code></pre></td></tr></table></div></div><p>⚠️ 这里需要注意的是：我的<code>CA主机</code>和<code>OpenVPN</code>主机是同一主机，所以上面的<code>/etc/openvpn</code>目录是<code>OpenVPN主机</code>的。</p><p>所有步骤都完成之后，在<code>/etc/openvpn</code>目录下应当有这些文件存在：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash><span class=o>[</span>root@test EasyRSA-CA<span class=o>]</span><span class=se>\#</span> ls /etc/openvpn/
ca.crt  client  dh.pem  server  server1.crt  server1.key  ta.key
</code></pre></td></tr></table></div></div><h3 id=配置openvpn服务>配置<code>OpenVPN</code>服务</h3><ol><li>将 OpenVPN 的模板配置文件复制到<code>/etc/openvpn</code>：</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>cp /usr/share/doc/openvpn-2.4.9/sample/sample-config-files/server.conf /etc/openvpn/server1.conf
</code></pre></td></tr></table></div></div><ol start=2><li>修改<code>server1.conf</code>，找到证书，密钥和DH参数指令并更改文件名：</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>user nobody
group nogroup
<span class=c1># ---------- 大约在78行左右 ----------</span>
cert server1.crt
key server1.key 

dh dh.pem

<span class=c1># 在文件末尾添加以下行。该指令会将消息身份验证算法（HMAC）从SHA1更改为SHA256</span>
auth SHA256
</code></pre></td></tr></table></div></div><p>ℹ️可选： 要通过VPN重定向客户端流量，请找到并取消注释<code>redirect-gateway</code>和<code>dhcp-option</code>选项：</p><p><code>/etc/openvpn/server1.conf</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-cfg data-lang=cfg><span class=na>push &#34;redirect-gateway def1 bypass-dhcp&#34;</span>

<span class=na>push &#34;dhcp-option DNS 208.67.222.222&#34;</span>
<span class=na>push &#34;dhcp-option DNS 208.67.220.220&#34;</span>
</code></pre></td></tr></table></div></div><p>默认情况下，使用OpenDNS解析器。您可以更改它并使用CloudFlare，Google或您想要的任何其他DNS解析器。</p><p>完整配置文件参考：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>port 1194
proto udp
dev tun
ca ca.crt
cert server1.crt
key server1.key  # This file should be kept secret
dh dh.pem
server 10.8.0.0 255.255.255.0
ifconfig-pool-persist ipp.txt
push &#34;redirect-gateway def1 bypass-dhcp&#34;
push &#34;dhcp-option DNS 208.67.222.222&#34;
push &#34;dhcp-option DNS 208.67.220.220&#34;
keepalive 10 120
tls-auth ta.key 0 # This file is secret
cipher AES-256-CBC
user nobody
group nobody
persist-key
persist-tun
status openvpn-status.log
verb 3
explicit-exit-notify 1
auth SHA256
</code></pre></td></tr></table></div></div><h3 id=启动-openvpn-服务>启动 OpenVPN 服务</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>systemctl start openvpn@server1
</code></pre></td></tr></table></div></div><p>成功启动之后，OpenVPN Server 会创建一个 tun 设备，即<code>tun0</code>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash><span class=o>[</span>root@test openvpn<span class=o>]</span><span class=se>\#</span> ip a show tun0
3: tun0: &lt;POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP&gt; mtu <span class=m>1500</span> qdisc pfifo_fast state UNKNOWN group default qlen <span class=m>100</span>
    link/none 
    inet 10.8.0.1 peer 10.8.0.2/32 scope global tun0
       valid_lft forever preferred_lft forever
    inet6 fe80::afaa:c6f7:7ae8:3a76/64 scope link flags <span class=m>800</span> 
       valid_lft forever preferred_lft forever
</code></pre></td></tr></table></div></div><p>为了正确转发网络数据包，我们需要启用IP转发：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash><span class=nb>echo</span> <span class=s2>&#34;net.ipv4.ip_forward = 1&#34;</span> &gt;&gt; /etc/sysctl.conf
sysctl -p
</code></pre></td></tr></table></div></div><h2 id=配置客户端接口>配置客户端接口</h2><p>创建一个单独的SSL证书，并为每个VPN客户端生成一个不同的配置文件。</p><p>客户端私钥和证书请求可以在客户端计算机或服务器上生成。为简单起见，我们将在服务器上生成证书请求，然后将其发送到CA进行签名。</p><p>生成客户端证书和配置文件的整个过程如下：</p><ol><li><p>在OpenVPN服务器上生成私钥和证书请求；</p></li><li><p>将请求发送到要签名的CA计算机；</p></li><li><p>将签名的SSL证书复制到OpenVPN服务器并生成配置文件；</p></li><li><p>将配置文件发送到VPN客户端的计算机。</p></li><li><p>首先，在<code>OpenVPN主机</code>上创建一组目录来存放客户端文件：</p></li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>mkdir -p ~/openvpn-clients/<span class=o>{</span>configs,base,files<span class=o>}</span>
</code></pre></td></tr></table></div></div><ul><li><code>base</code> 目录将存储将在所有客户端文件之间共享的基本文件和配置；</li><li><code>configs</code> 目录将存储生成的客户端配置；</li><li><code>files</code> 目录将存储特定于客户端的证书/密钥对。</li></ul><ol start=2><li>复制<code>ca.crt</code>和<code>ta.key</code>文件到<code>~/openvpn-clients/base</code>目录：</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>cp ~/EasyRSA-Server1/ta.key ~/openvpn-clients/base/
cp /etc/openvpn/ca.crt ~/openvpn-clients/base/
</code></pre></td></tr></table></div></div><ol start=3><li>将示例客户端配置文件复制到<code>~/openvpn-clients/base/</code>目录下：</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>cp /usr/share/doc/openvpn-2.4.9/sample/sample-config-files/client.conf ~/openvpn-clients/base/
</code></pre></td></tr></table></div></div><ol start=4><li>编辑<code>client.conf</code>文件以匹配我们的服务器配置：</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>remote 172.16.1.131 <span class=m>1194</span>
<span class=c1># 在文件结尾添加以下内容</span>
auth SHA256
key-direction <span class=m>1</span>
</code></pre></td></tr></table></div></div><p>完整配置文件参考如下所示：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>client
dev tun
proto udp
remote 172.16.1.131 1194
resolv-retry infinite
nobind
persist-key
persist-tun
remote-cert-tls server
cipher AES-256-CBC
verb 3
auth SHA256
key-direction 1
</code></pre></td></tr></table></div></div><ol start=5><li>接下来，创建一个简单的bash脚本，它将基本配置和文件与客户端证书和密钥合并，并将生成的配置存储在<code>~/openvpn-clients/configs</code>目录中：</li></ol><p><code>vim ~/openvpn-clients/gen_config.sh</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash><span class=cp>#!/bin/bash
</span><span class=cp></span>
<span class=nv>FILES_DIR</span><span class=o>=</span><span class=nv>$HOME</span>/openvpn-clients/files
<span class=nv>BASE_DIR</span><span class=o>=</span><span class=nv>$HOME</span>/openvpn-clients/base
<span class=nv>CONFIGS_DIR</span><span class=o>=</span><span class=nv>$HOME</span>/openvpn-clients/configs

<span class=nv>BASE_CONF</span><span class=o>=</span><span class=si>${</span><span class=nv>BASE_DIR</span><span class=si>}</span>/client.conf
<span class=nv>CA_FILE</span><span class=o>=</span><span class=si>${</span><span class=nv>BASE_DIR</span><span class=si>}</span>/ca.crt
<span class=nv>TA_FILE</span><span class=o>=</span><span class=si>${</span><span class=nv>BASE_DIR</span><span class=si>}</span>/ta.key

<span class=nv>CLIENT_CERT</span><span class=o>=</span><span class=si>${</span><span class=nv>FILES_DIR</span><span class=si>}</span>/<span class=si>${</span><span class=nv>1</span><span class=si>}</span>.crt
<span class=nv>CLIENT_KEY</span><span class=o>=</span><span class=si>${</span><span class=nv>FILES_DIR</span><span class=si>}</span>/<span class=si>${</span><span class=nv>1</span><span class=si>}</span>.key

<span class=c1># Test for files</span>
<span class=k>for</span> i in <span class=s2>&#34;</span><span class=nv>$BASE_CONF</span><span class=s2>&#34;</span> <span class=s2>&#34;</span><span class=nv>$CA_FILE</span><span class=s2>&#34;</span> <span class=s2>&#34;</span><span class=nv>$TA_FILE</span><span class=s2>&#34;</span> <span class=s2>&#34;</span><span class=nv>$CLIENT_CERT</span><span class=s2>&#34;</span> <span class=s2>&#34;</span><span class=nv>$CLIENT_KEY</span><span class=s2>&#34;</span><span class=p>;</span> <span class=k>do</span>
    <span class=k>if</span> <span class=o>[[</span> ! -f <span class=nv>$i</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
        <span class=nb>echo</span> <span class=s2>&#34; The file </span><span class=nv>$i</span><span class=s2> does not exist&#34;</span>
        <span class=nb>exit</span> <span class=m>1</span>
    <span class=k>fi</span>

    <span class=k>if</span> <span class=o>[[</span> ! -r <span class=nv>$i</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
        <span class=nb>echo</span> <span class=s2>&#34; The file </span><span class=nv>$i</span><span class=s2> is not readable.&#34;</span>
        <span class=nb>exit</span> <span class=m>1</span>
    <span class=k>fi</span>
<span class=k>done</span>

<span class=c1># Generate client config</span>
cat &gt; <span class=si>${</span><span class=nv>CONFIGS_DIR</span><span class=si>}</span>/<span class=si>${</span><span class=nv>1</span><span class=si>}</span>.ovpn <span class=s>&lt;&lt;EOF
</span><span class=s>$(cat ${BASE_CONF})
</span><span class=s>&lt;key&gt;
</span><span class=s>$(cat ${CLIENT_KEY})
</span><span class=s>&lt;/key&gt;
</span><span class=s>&lt;cert&gt;
</span><span class=s>$(cat ${CLIENT_CERT})
</span><span class=s>&lt;/cert&gt;
</span><span class=s>&lt;ca&gt;
</span><span class=s>$(cat ${CA_FILE})
</span><span class=s>&lt;/ca&gt;
</span><span class=s>&lt;tls-auth&gt;
</span><span class=s>$(cat ${TA_FILE})
</span><span class=s>&lt;/tls-auth&gt;
</span><span class=s>EOF</span>
</code></pre></td></tr></table></div></div><p>赋予执行权限：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>chmod +x ~/openvpn-clients/gen_config.sh
</code></pre></td></tr></table></div></div><h2 id=创建客户端证书私钥和配置>创建客户端证书私钥和配置</h2><p>生成客户端私钥和证书请求的过程与生成服务器密钥和证书请求的过程相同。</p><ol><li>登录<code>OpenVPN主机</code>为客户端生成一个新的私钥和一个证书请求：</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash><span class=nb>cd</span> ~/EasyRSA-Server1
./easyrsa gen-req client1 nopass
</code></pre></td></tr></table></div></div><ol start=2><li>将私钥<code>client1.key</code>复制到<code>~/openvpn-clients/files</code>中：</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>cp ~/EasyRSA-Server1/pki/private/client1.key ~/openvpn-clients/files/
</code></pre></td></tr></table></div></div><ol start=3><li>将证书请求文件传输到<code>CA主机</code>：</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>cp ~/EasyRSA-Server1/pki/reqs/client1.req /tmp
</code></pre></td></tr></table></div></div><ol start=4><li>进入<code>CA主机</code>，导入证书请求并进行签署：</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash><span class=nb>cd</span> ~/EasyRSA-CA
./easyrsa import-req /tmp/client1.req client1
./easyrsa sign-req client client1
</code></pre></td></tr></table></div></div><ol start=5><li>接下来，将签好名的证书<code>client1.crt</code>文件发送回<code>OpenVPN主机</code>：</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>cp ~/EasyRSA-CA/pki/issued/client1.crt ~/openvpn-clients/files
</code></pre></td></tr></table></div></div><ol start=6><li>最后一步是使用<code>gen_config.sh</code>脚本生成客户端配置，切换到<code>~/openvpn-clients</code>目录并使用客户端名称作为参数运行脚本：</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash><span class=nb>cd</span> ~/openvpn-clients
./gen_config.sh client1
</code></pre></td></tr></table></div></div><p>该脚本将在<code>~/client-configs/configs</code>目录中创建一个名为<code>client1.ovpn</code>的文件：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash><span class=o>[</span>root@test openvpn-clients<span class=o>]</span><span class=se>\#</span> ls ~/openvpn-clients/configs
client1.ovpn
</code></pre></td></tr></table></div></div><p>此时，客户端配置已创建，可以直接将配置文件传输到要用作客户端的设备上。</p><p>如果想要添加其他的客户端，重复这些步骤即可。</p><h2 id=使用-openvpn>使用 OpenVPN</h2><p>在<code>Debian</code>系系统下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>sudo apt update -y <span class=o>&amp;&amp;</span> sudo apt instal openvpn
</code></pre></td></tr></table></div></div><p>安装完软件包之后，使用以下命令连接到<code>OpenVPN</code>服务器：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>sudo openvpn --config client1.ovpn
</code></pre></td></tr></table></div></div><h2 id=快速安装-openvpn>快速安装 OpenVPN</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>sudo apt update -y
sudo apt install -y openvpn
</code></pre></td></tr></table></div></div><p>从 github 获取一键安装脚本:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>git clone https://github.com/angristan/openvpn-install.git
<span class=nb>cd</span> openvpn-install
</code></pre></td></tr></table></div></div><p>赋予脚本可执行权限:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>chmod +x openvpn-install
</code></pre></td></tr></table></div></div><p>执行脚本:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash><span class=nv>AUTO_INSTALL</span><span class=o>=</span>y ./openvpn-install.sh
</code></pre></td></tr></table></div></div><p>⚠️ 注意: 在客户端使用 OpenVPN 时, 要确保服务器端的 OpenVPN 监听的端口处于放行状态.</p><p>Linux 客户端使用:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>sudo apt install network-manager-openvpn
</code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>sudo openvpn ./client.ovpn
</code></pre></td></tr></table></div></div><p>Windows 客户端使用:</p><p>直接去<a href=https://openvpn.net/community-downloads/> OpenVPN 官方下载站点</a>下载然后导入客户端配置文件 <code>client.ovpn</code>, 然后启动服务即可.</p></div><div class=post-copyright><p class=copyright-item><span class=item-title>Author</span>
<span class=item-content><a href=https://agou-ops.top/author/agou-ops/>AGou-ops</a></span></p><p class=copyright-item><span class=item-title>LastMod</span>
<span class=item-content>2020-05-21</span></p><p class=copyright-item><span class=item-title>License</span>
<span class=item-content><a href=https://creativecommons.org/licenses/by-nc-nd/4.0/ rel=noopener target=_blank>CC BY-NC-ND 4.0</a></span></p></div><div class=post-reward><input type=checkbox name=reward id=reward hidden>
<label class=reward-button for=reward>Reward</label><div class=qr-code><label class=qr-code-image for=reward><img class=image src=https://s1.ax1x.com/2020/03/12/8m9GPe.png>
<span>Wechat</span></label>
<label class=qr-code-image for=reward><img class=image src=https://s1.ax1x.com/2020/03/12/8m9J8H.png>
<span>Alipay</span></label></div></div><footer class=post-footer><div class=post-tags><a href=https://agou-ops.top/tags/openvpn/>OpenVPN</a>
<a href=https://agou-ops.top/tags/centos/>CentOS</a></div><nav class=post-nav><a class=prev href=/post/scrcpy-android%E6%8A%95%E5%B1%8F%E7%A5%9E%E5%99%A8/><i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18"><path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417l277.93508-310.326815c11.338233-12.190647 11.035334-32.285311-.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"/></svg></i><span class="prev-text nav-default">Scrcpy Android投屏神器</span>
<span class="prev-text nav-mobile">Prev</span></a>
<a class=next href=/post/wireguard-vpn-for-ubuntu/><span class="next-text nav-default">WireGuard VPN for Ubuntu</span>
<span class="prev-text nav-mobile">Next</span>
<i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18"><path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"/></svg></i></a></nav></footer></article><div class="post bg-white"><script src=https://utteranc.es/client.js repo=AGou-ops/comments issue-term=pathname theme=github-light crossorigin=anonymous async></script></div></div></div></main><footer id=footer class=footer><div class=icon-links><a href=mailto:agou-ops@foxmail.com rel="me noopener" class=iconfont title=email><svg class="icon" viewBox="0 0 1451 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="36" height="36"><path d="M664.781909 681.472759.0 97.881301C0 3.997201 71.046997.0 71.046997.0H474.477909 961.649408 1361.641813S1432.688811 3.997201 1432.688811 97.881301L771.345323 681.472759S764.482731 685.154773 753.594283 688.65053V688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858V688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759zM718.063616 811.603883C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633.0 212.052267.0 212.052267V942.809523L83.726336 1024H682.532949 753.579947 1348.948139L1432.688811 942.809523V212.052267S893.138176 701.759633 817.019477 767.734955C777.248 802.205449 742.347691 811.03081 718.063616 811.603883z"/></svg></a><a href=https://twitter.com/AgouOps rel="me noopener" class=iconfont title=twitter target=_blank><svg class="icon" viewBox="0 0 1264 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="36" height="36"><path d="M1229.8616 18.043658s-117.852626 63.135335-164.151872 67.344358c-105.225559-164.151872-505.082682-92.598492-437.738325 223.078185C278.622548 312.675223 89.216542 47.506814 89.216542 47.506814s-117.852626 189.406006 75.762402 345.139833C127.097743 396.85567 55.544363 371.601535 55.544363 371.601535S26.081207 535.753407 253.368414 615.724832c-21.045112 29.463156-113.643603 8.418045-113.643603 8.418045s25.254134 143.10676 231.496229 180.987961c-143.10676 130.479693-387.230056 92.598492-370.393967 105.225559 206.242095 189.406006 1119.599946 231.496229 1128.01799-643.98042C1179.353331 249.539887 1263.533778 123.269217 1263.533778 123.269217s-130.479693 37.881201-138.897738 33.672179C1225.652577 98.015083 1229.8616 18.043658 1229.8616 18.043658"/></svg></a><a href=https://github.com/AGou-ops rel="me noopener" class=iconfont title=github target=_blank><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="36" height="36"><path d="M512 12.672c-282.88.0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667.0-12.16-.426667-44.373333-.64-87.04-142.421333 30.890667-172.458667-68.693333-172.458667-68.693333C188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333.0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333.0.0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667.0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72.0 68.522667-.64 123.562667-.64 140.202666.0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"/></svg></a><a href=https://agou-ops.top/index.xml rel="noopener alternate" type=application/rss+xml class=iconfont title=rss target=_blank><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="30" height="30"><path d="M819.157333 1024C819.157333 574.592 449.408 204.8.0 204.8V0c561.706667.0 1024 462.293333 1024 1024H819.157333zM140.416 743.04a140.8 140.8.0 01140.501333 140.586667A140.928 140.928.0 01140.074667 1024C62.72 1024 0 961.109333.0 883.626667S62.933333 743.082667 140.416 743.04zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667V345.173333c372.352.0 678.784 306.517333 678.784 678.826667z"/></svg></a></div><div class=copyright><span class=copyright-year>&copy;
2020
<span class=heart><i class=iconfont><svg class="icon" viewBox="0 0 1025 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="14" height="14"><path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7.0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1.0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2.0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3.1-42.5-8-83.6-24-122.2z" fill="#8a8a8a"/></svg></i></span><span class=author>AGou-ops</span></span>
<span id=busuanzi_container>访客数/访问量：<span id=busuanzi_value_site_uv></span>/<span id=busuanzi_value_site_pv></span></span></div></footer><div class=back-to-top id=back-to-top><i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="35" height="35"><path d="M510.866688 227.694839 95.449397 629.218702h235.761562L329.15309 958.01517h362.40389L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777h894.052392v131.813095H63.840492V63.962777zm0 0"/></svg></i></div></div><script type=text/javascript src=https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js crossorigin=anonymous></script><script type=text/javascript src=https://cdn.bootcss.com/slideout/1.0.1/slideout.min.js crossorigin=anonymous></script><script type=text/javascript src=/js/main.638251f4230630f0335d8c6748e53a96f94b72670920b60c09a56fdc8bece214.js integrity="sha256-Y4JR9CMGMPAzXYxnSOU6lvlLcmcJILYMCaVv3Ivs4hQ=" crossorigin=anonymous></script><script src=/js/load-photoswipe.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/photoswipe.min.js integrity="sha256-UplRCs9v4KXVJvVY+p+RSo5Q4ilAUXh7kpjyIP5odyc=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/photoswipe-ui-default.min.js integrity="sha256-PWHOlUzc96pMc8ThwRIXPn8yH4NOLu42RQ0b9SpnpFk=" crossorigin=anonymous></script><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script></body></html>